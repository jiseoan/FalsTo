<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ProjectManager - Brackets API</title>
    <link rel="stylesheet" href="../../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../../assets/css/typeahead.js-bootstrap.css">
    <link rel="stylesheet" href="../../assets/css/font-awesome.css">
    <link rel="stylesheet" href="../../assets/css/prism.css">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.css">
    <![endif]-->
    <script type="text/javascript" src="../../assets/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../../assets/js/bootstrap.js"></script>
    <script type="text/javascript" src="../../assets/js/typeahead.js"></script>
    <script type="text/javascript" src="../../assets/js/main.js"></script>
    <script src="http://use.edgefonts.net/source-sans-pro:n3,i3,n4,i4;source-code-pro.js"></script>

    <!-- Control the Flash of Unstyled Text (or FOUT) -->
    <style type="text/css">
        .wf-loading h1, .wf-loading h2, .wf-loading h3, .wf-loading h4,
        .wf-loading h5, .wf-loading h6, .wf-loading p, .wf-loading a {
            visibility: hidden;
        }
    </style>
    
    <script>
      window.moduleLevel = "../..";
    </script>
  </head>
  
  <body>
    <div class="row-fluid">
      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <a class="brand" href="../../index.html">Brackets API</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li><a href="#dependencies">Dependencies</a></li>
                <li><a href="#variables">Variables</a></li>
                <li><a href="#functions">Functions</a></li>
                <li><a href="#classes">Classes</a></li>
              </ul>
            </div>
            <input class="typeahead" placeholder="Search..." type="text" >
          </div>
        </div>
      </div>    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="left-section">
            <h2 class="number-of-modules">Modules (145)</h2>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_"><i class="icon-folder-open"></i>[root]</a>
              </li>
            </ul>
            <ul id="package_" class="nav nav-list">
              <li><a href="../../modules/brackets.html">brackets</a></li>
              <li><a href="../../modules/dependencies.html">dependencies</a></li>
              <li><a href="../../modules/main.html">main</a></li>
              <li><a href="../../modules/strings.html">strings</a></li>
              <li><a href="../../modules/xorigin.html">xorigin</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_command"><i class="icon-folder-open"></i>command</a>
              </li>
            </ul>
            <ul id="package_command" class="nav nav-list">
              <li><a href="../../modules/command/CommandManager.html">CommandManager</a></li>
              <li><a href="../../modules/command/Commands.html">Commands</a></li>
              <li><a href="../../modules/command/DefaultMenus.html">DefaultMenus</a></li>
              <li><a href="../../modules/command/KeyBindingManager.html">KeyBindingManager</a></li>
              <li><a href="../../modules/command/Menus.html">Menus</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_document"><i class="icon-folder-open"></i>document</a>
              </li>
            </ul>
            <ul id="package_document" class="nav nav-list">
              <li><a href="../../modules/document/ChangedDocumentTracker.html">ChangedDocumentTracker</a></li>
              <li><a href="../../modules/document/Document.html">Document</a></li>
              <li><a href="../../modules/document/DocumentCommandHandlers.html">DocumentCommandHandlers</a></li>
              <li><a href="../../modules/document/DocumentManager.html">DocumentManager</a></li>
              <li><a href="../../modules/document/InMemoryFile.html">InMemoryFile</a></li>
              <li><a href="../../modules/document/TextRange.html">TextRange</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_editor"><i class="icon-folder-open"></i>editor</a>
              </li>
            </ul>
            <ul id="package_editor" class="nav nav-list">
              <li><a href="../../modules/editor/CodeHintList.html">CodeHintList</a></li>
              <li><a href="../../modules/editor/CodeHintManager.html">CodeHintManager</a></li>
              <li><a href="../../modules/editor/CSSInlineEditor.html">CSSInlineEditor</a></li>
              <li><a href="../../modules/editor/Editor.html">Editor</a></li>
              <li><a href="../../modules/editor/EditorCommandHandlers.html">EditorCommandHandlers</a></li>
              <li><a href="../../modules/editor/EditorManager.html">EditorManager</a></li>
              <li><a href="../../modules/editor/EditorOptionHandlers.html">EditorOptionHandlers</a></li>
              <li><a href="../../modules/editor/EditorStatusBar.html">EditorStatusBar</a></li>
              <li><a href="../../modules/editor/ImageViewer.html">ImageViewer</a></li>
              <li><a href="../../modules/editor/InlineTextEditor.html">InlineTextEditor</a></li>
              <li><a href="../../modules/editor/InlineWidget.html">InlineWidget</a></li>
              <li><a href="../../modules/editor/MultiRangeInlineEditor.html">MultiRangeInlineEditor</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_extensibility"><i class="icon-folder-open"></i>extensibility</a>
              </li>
            </ul>
            <ul id="package_extensibility" class="nav nav-list">
              <li><a href="../../modules/extensibility/ExtensionManager.html">ExtensionManager</a></li>
              <li><a href="../../modules/extensibility/ExtensionManagerDialog.html">ExtensionManagerDialog</a></li>
              <li><a href="../../modules/extensibility/ExtensionManagerView.html">ExtensionManagerView</a></li>
              <li><a href="../../modules/extensibility/ExtensionManagerViewModel.html">ExtensionManagerViewModel</a></li>
              <li><a href="../../modules/extensibility/InstallExtensionDialog.html">InstallExtensionDialog</a></li>
              <li><a href="../../modules/extensibility/Package.html">Package</a></li>
              <li><a href="../../modules/extensibility/registry_utils.html">registry_utils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_file"><i class="icon-folder-open"></i>file</a>
              </li>
            </ul>
            <ul id="package_file" class="nav nav-list">
              <li><a href="../../modules/file/FileUtils.html">FileUtils</a></li>
              <li><a href="../../modules/file/NativeFileError.html">NativeFileError</a></li>
              <li><a href="../../modules/file/NativeFileSystem.html">NativeFileSystem</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_filesystem"><i class="icon-folder-open"></i>filesystem</a>
              </li>
            </ul>
            <ul id="package_filesystem" class="nav nav-list">
              <li><a href="../../modules/filesystem/Directory.html">Directory</a></li>
              <li><a href="../../modules/filesystem/File.html">File</a></li>
              <li><a href="../../modules/filesystem/FileIndex.html">FileIndex</a></li>
              <li><a href="../../modules/filesystem/FileSystem.html">FileSystem</a></li>
              <li><a href="../../modules/filesystem/FileSystemEntry.html">FileSystemEntry</a></li>
              <li><a href="../../modules/filesystem/FileSystemError.html">FileSystemError</a></li>
              <li><a href="../../modules/filesystem/FileSystemStats.html">FileSystemStats</a></li>
              <li><a href="../../modules/filesystem/WatchedRoot.html">WatchedRoot</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_filesystem_impls_appshell"><i class="icon-folder-open"></i>filesystem&#x2F;impls&#x2F;appshell</a>
              </li>
            </ul>
            <ul id="package_filesystem_impls_appshell" class="nav nav-list">
              <li><a href="../../modules/filesystem/impls/appshell/AppshellFileSystem.html">AppshellFileSystem</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_filesystem_impls_appshell_node"><i class="icon-folder-open"></i>filesystem&#x2F;impls&#x2F;appshell&#x2F;node</a>
              </li>
            </ul>
            <ul id="package_filesystem_impls_appshell_node" class="nav nav-list">
              <li><a href="../../modules/filesystem/impls/appshell/node/FileWatcherDomain.html">FileWatcherDomain</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_help"><i class="icon-folder-open"></i>help</a>
              </li>
            </ul>
            <ul id="package_help" class="nav nav-list">
              <li><a href="../../modules/help/HelpCommandHandlers.html">HelpCommandHandlers</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_language"><i class="icon-folder-open"></i>language</a>
              </li>
            </ul>
            <ul id="package_language" class="nav nav-list">
              <li><a href="../../modules/language/CodeInspection.html">CodeInspection</a></li>
              <li><a href="../../modules/language/CSSUtils.html">CSSUtils</a></li>
              <li><a href="../../modules/language/HTMLDOMDiff.html">HTMLDOMDiff</a></li>
              <li><a href="../../modules/language/HTMLInstrumentation.html">HTMLInstrumentation</a></li>
              <li><a href="../../modules/language/HTMLSimpleDOM.html">HTMLSimpleDOM</a></li>
              <li><a href="../../modules/language/HTMLTokenizer.html">HTMLTokenizer</a></li>
              <li><a href="../../modules/language/HTMLUtils.html">HTMLUtils</a></li>
              <li><a href="../../modules/language/JSUtils.html">JSUtils</a></li>
              <li><a href="../../modules/language/LanguageManager.html">LanguageManager</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Agents"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Agents</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Agents" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Agents/ConsoleAgent.html">ConsoleAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/CSSAgent.html">CSSAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/DOMAgent.html">DOMAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/DOMHelpers.html">DOMHelpers</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/DOMNode.html">DOMNode</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/EditAgent.html">EditAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/GotoAgent.html">GotoAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/HighlightAgent.html">HighlightAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/NetworkAgent.html">NetworkAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/RemoteAgent.html">RemoteAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/RemoteFunctions.html">RemoteFunctions</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/ScriptAgent.html">ScriptAgent</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Documents"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Documents</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Documents" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Documents/CSSDocument.html">CSSDocument</a></li>
              <li><a href="../../modules/LiveDevelopment/Documents/HTMLDocument.html">HTMLDocument</a></li>
              <li><a href="../../modules/LiveDevelopment/Documents/JSDocument.html">JSDocument</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Inspector"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Inspector</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Inspector" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Inspector/Inspector.html">Inspector</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment"><i class="icon-folder-open"></i>LiveDevelopment</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/LiveDevelopment.html">LiveDevelopment</a></li>
              <li><a href="../../modules/LiveDevelopment/LiveDevServerManager.html">LiveDevServerManager</a></li>
              <li><a href="../../modules/LiveDevelopment/main.html">main</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Servers"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Servers</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Servers" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Servers/BaseServer.html">BaseServer</a></li>
              <li><a href="../../modules/LiveDevelopment/Servers/FileServer.html">FileServer</a></li>
              <li><a href="../../modules/LiveDevelopment/Servers/UserServer.html">UserServer</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_preferences"><i class="icon-folder-open"></i>preferences</a>
              </li>
            </ul>
            <ul id="package_preferences" class="nav nav-list">
              <li><a href="../../modules/preferences/PreferencesBase.html">PreferencesBase</a></li>
              <li><a href="../../modules/preferences/PreferencesDialogs.html">PreferencesDialogs</a></li>
              <li><a href="../../modules/preferences/PreferencesImpl.html">PreferencesImpl</a></li>
              <li><a href="../../modules/preferences/PreferencesManager.html">PreferencesManager</a></li>
              <li><a href="../../modules/preferences/PreferenceStorage.html">PreferenceStorage</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_project"><i class="icon-folder-open"></i>project</a>
              </li>
            </ul>
            <ul id="package_project" class="nav nav-list">
              <li><a href="../../modules/project/FileIndexManager.html">FileIndexManager</a></li>
              <li><a href="../../modules/project/FileSyncManager.html">FileSyncManager</a></li>
              <li><a href="../../modules/project/FileViewController.html">FileViewController</a></li>
              <li><a href="../../modules/project/ProjectManager.html">ProjectManager</a></li>
              <li><a href="../../modules/project/SidebarView.html">SidebarView</a></li>
              <li><a href="../../modules/project/WorkingSetSort.html">WorkingSetSort</a></li>
              <li><a href="../../modules/project/WorkingSetView.html">WorkingSetView</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_search"><i class="icon-folder-open"></i>search</a>
              </li>
            </ul>
            <ul id="package_search" class="nav nav-list">
              <li><a href="../../modules/search/FileFilters.html">FileFilters</a></li>
              <li><a href="../../modules/search/FindBar.html">FindBar</a></li>
              <li><a href="../../modules/search/FindInFiles.html">FindInFiles</a></li>
              <li><a href="../../modules/search/FindInFilesUI.html">FindInFilesUI</a></li>
              <li><a href="../../modules/search/FindReplace.html">FindReplace</a></li>
              <li><a href="../../modules/search/FindUtils.html">FindUtils</a></li>
              <li><a href="../../modules/search/QuickOpen.html">QuickOpen</a></li>
              <li><a href="../../modules/search/ScrollTrackMarkers.html">ScrollTrackMarkers</a></li>
              <li><a href="../../modules/search/SearchModel.html">SearchModel</a></li>
              <li><a href="../../modules/search/SearchResultsView.html">SearchResultsView</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_utils"><i class="icon-folder-open"></i>utils</a>
              </li>
            </ul>
            <ul id="package_utils" class="nav nav-list">
              <li><a href="../../modules/utils/AnimationUtils.html">AnimationUtils</a></li>
              <li><a href="../../modules/utils/AppInit.html">AppInit</a></li>
              <li><a href="../../modules/utils/Async.html">Async</a></li>
              <li><a href="../../modules/utils/BuildInfoUtils.html">BuildInfoUtils</a></li>
              <li><a href="../../modules/utils/CollectionUtils.html">CollectionUtils</a></li>
              <li><a href="../../modules/utils/ColorUtils.html">ColorUtils</a></li>
              <li><a href="../../modules/utils/DeprecationWarning.html">DeprecationWarning</a></li>
              <li><a href="../../modules/utils/DragAndDrop.html">DragAndDrop</a></li>
              <li><a href="../../modules/utils/DropdownEventHandler.html">DropdownEventHandler</a></li>
              <li><a href="../../modules/utils/ExtensionLoader.html">ExtensionLoader</a></li>
              <li><a href="../../modules/utils/ExtensionUtils.html">ExtensionUtils</a></li>
              <li><a href="../../modules/utils/Global.html">Global</a></li>
              <li><a href="../../modules/utils/KeyEvent.html">KeyEvent</a></li>
              <li><a href="../../modules/utils/NativeApp.html">NativeApp</a></li>
              <li><a href="../../modules/utils/NodeConnection.html">NodeConnection</a></li>
              <li><a href="../../modules/utils/NodeDomain.html">NodeDomain</a></li>
              <li><a href="../../modules/utils/PerfUtils.html">PerfUtils</a></li>
              <li><a href="../../modules/utils/Resizer.html">Resizer</a></li>
              <li><a href="../../modules/utils/ShellAPI.html">ShellAPI</a></li>
              <li><a href="../../modules/utils/StringMatch.html">StringMatch</a></li>
              <li><a href="../../modules/utils/StringUtils.html">StringUtils</a></li>
              <li><a href="../../modules/utils/TokenUtils.html">TokenUtils</a></li>
              <li><a href="../../modules/utils/UpdateNotification.html">UpdateNotification</a></li>
              <li><a href="../../modules/utils/UrlParams.html">UrlParams</a></li>
              <li><a href="../../modules/utils/ValidationUtils.html">ValidationUtils</a></li>
              <li><a href="../../modules/utils/ViewUtils.html">ViewUtils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_view"><i class="icon-folder-open"></i>view</a>
              </li>
            </ul>
            <ul id="package_view" class="nav nav-list">
              <li><a href="../../modules/view/PanelManager.html">PanelManager</a></li>
              <li><a href="../../modules/view/ViewCommandHandlers.html">ViewCommandHandlers</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_widgets"><i class="icon-folder-open"></i>widgets</a>
              </li>
            </ul>
            <ul id="package_widgets" class="nav nav-list">
              <li><a href="../../modules/widgets/bootstrap-alerts.html">bootstrap-alerts</a></li>
              <li><a href="../../modules/widgets/bootstrap-button.html">bootstrap-button</a></li>
              <li><a href="../../modules/widgets/bootstrap-dropdown.html">bootstrap-dropdown</a></li>
              <li><a href="../../modules/widgets/bootstrap-modal.html">bootstrap-modal</a></li>
              <li><a href="../../modules/widgets/bootstrap-popover.html">bootstrap-popover</a></li>
              <li><a href="../../modules/widgets/bootstrap-scrollspy.html">bootstrap-scrollspy</a></li>
              <li><a href="../../modules/widgets/bootstrap-tab.html">bootstrap-tab</a></li>
              <li><a href="../../modules/widgets/bootstrap-tooltip.html">bootstrap-tooltip</a></li>
              <li><a href="../../modules/widgets/bootstrap-twipsy-mod.html">bootstrap-twipsy-mod</a></li>
              <li><a href="../../modules/widgets/DefaultDialogs.html">DefaultDialogs</a></li>
              <li><a href="../../modules/widgets/Dialogs.html">Dialogs</a></li>
              <li><a href="../../modules/widgets/DropdownButton.html">DropdownButton</a></li>
              <li><a href="../../modules/widgets/ModalBar.html">ModalBar</a></li>
              <li><a href="../../modules/widgets/PopUpManager.html">PopUpManager</a></li>
              <li><a href="../../modules/widgets/StatusBar.html">StatusBar</a></li>
            </ul>
          </div>
        </div>
        <div class="module span9">
<h1>ProjectManager</h1>


<section class="description">
    <h3>Description</h3>
    
    <div><p>ProjectManager is the model for the set of currently open project. It is responsible for
creating and updating the project tree when projects are opened and when changes occur to
the file tree.</p>
<p>This module dispatches these events:</p>
<ul>
<li>beforeProjectClose -- before <code>_projectRoot</code> changes, but working set files still open</li>
<li>projectClose       -- <em>just</em> before <code>_projectRoot</code> changes; working set already cleared
&amp; project root unwatched</li>
<li>beforeAppClose     -- before Brackets quits entirely</li>
<li>projectOpen        -- after <code>_projectRoot</code> changes and the tree is re-rendered</li>
<li>projectRefresh     -- when project tree is re-rendered for a reason other than
a project being opened (e.g. from the Refresh command)</li>
</ul>
<p>These are jQuery events, so to listen for them you do something like this:
   $(ProjectManager).on(&quot;eventname&quot;, handler);</p>
</div>
</section>

<section id="dependencies">
    <h3>Dependencies</h3>

    <ul class="nav nav-list">
        <li><a href="..&#x2F;../modules/utils/AppInit.html">AppInit</a></li>
        <li><a href="..&#x2F;../modules/utils/Async.html">Async</a></li>
        <li><a href="..&#x2F;../modules/command/CommandManager.html">CommandManager</a></li>
        <li><a href="..&#x2F;../modules/command/Commands.html">Commands</a></li>
        <li><a href="..&#x2F;../modules/widgets/DefaultDialogs.html">DefaultDialogs</a></li>
        <li><a href="..&#x2F;../modules/utils/DeprecationWarning.html">DeprecationWarning</a></li>
        <li><a href="..&#x2F;../modules/widgets/Dialogs.html">Dialogs</a></li>
        <li><a href="..&#x2F;../modules/document/DocumentManager.html">DocumentManager</a></li>
        <li><a href="..&#x2F;../modules/editor/EditorManager.html">EditorManager</a></li>
        <li><a href="..&#x2F;../modules/project/FileSyncManager.html">FileSyncManager</a></li>
        <li><a href="..&#x2F;../modules/filesystem/FileSystem.html">FileSystem</a></li>
        <li><a href="..&#x2F;../modules/filesystem/FileSystemError.html">FileSystemError</a></li>
        <li><a href="..&#x2F;../modules/file/FileUtils.html">FileUtils</a></li>
        <li><a href="..&#x2F;../modules/project/FileViewController.html">FileViewController</a></li>
        <li><a href="..&#x2F;../modules/utils/Global.html">Global</a></li>
        <li><a href="..&#x2F;../modules/document/InMemoryFile.html">InMemoryFile</a></li>
        <li><a href="..&#x2F;../modules/thirdparty/jstree_pre1.0_fix_1/jquery.jstree.html">jquery.jstree</a></li>
        <li><a href="..&#x2F;../modules/utils/KeyEvent.html">KeyEvent</a></li>
        <li><a href="..&#x2F;../modules/language/LanguageManager.html">LanguageManager</a></li>
        <li><a href="..&#x2F;../modules/thirdparty/lodash.html">lodash</a></li>
        <li><a href="..&#x2F;../modules/command/Menus.html">Menus</a></li>
        <li><a href="..&#x2F;../modules/utils/PerfUtils.html">PerfUtils</a></li>
        <li><a href="..&#x2F;../modules/preferences/PreferencesDialogs.html">PreferencesDialogs</a></li>
        <li><a href="..&#x2F;../modules/preferences/PreferencesManager.html">PreferencesManager</a></li>
        <li><a href="..&#x2F;../modules/strings.html">strings</a></li>
        <li><a href="..&#x2F;../modules/utils/StringUtils.html">StringUtils</a></li>
        <li><a href="..&#x2F;../modules/i18n!nls/urls.html">urls</a></li>
        <li><a href="..&#x2F;../modules/utils/ViewUtils.html">ViewUtils</a></li>
    </ul>

</section>
<section id="variables">
    
    <h3>Variables 
<label class="checkbox">
    <input class="toggle-public" type="checkbox"> Show Private Members
</label>    </h3>

<div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>$projectTreeContainer</h4>

    
<dl>
    <dt>Type</dt>
    <dd>jQueryObject</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var $projectTreeContainer;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>$projectTreeList</h4>

    
<dl>
    <dt>Type</dt>
    <dd>DOMElement</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var $projectTreeList;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>SETTINGS_FILENAME</h4>

    
<dl>
    <dt>Type</dt>
    <dd>string</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var SETTINGS_FILENAME = &quot;.&quot; + PreferencesManager.SETTINGS_FILENAME;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_allFilesCachePromise</h4>

    
<dl>
    <dt>Type</dt>
    <dd>?jQuery.Promise.&lt;Array&lt;File&gt;&gt;</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _allFilesCachePromise = null;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_dirFirst</h4>

    
<dl>
    <dt>Type</dt>
    <dd>boolean</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _dirFirst;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_exclusionListRegEx</h4>

    
<dl>
    <dt>Type</dt>
    <dd>RegExp</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _exclusionListRegEx = &#x2F;\.pyc$|^\.git$|^\.gitmodules$|^\.svn$|^\.DS_Store$|^Thumbs\.db$|^\.hg$|^CVS$|^\.hgtags$|^\.idea$|^\.c9revisions$|^\.SyncArchive$|^\.SyncID$|^\.SyncIgnore$|\~$&#x2F;;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_fileSystemChange</h4>

    
<dl>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _fileSystemChange,
        _fileSystemRename;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_illegalFilenamesRegEx</h4>

    
<dl>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">            
    var _illegalFilenamesRegEx = &#x2F;^(\.+|com[1-9]|lpt[1-9]|nul|con|prn|aux|)$|\.+$&#x2F;i;
    
    var suppressToggleOpen = false;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_invalidChars</h4>

    
<dl>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _invalidChars;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_lastSelected</h4>

    
<dl>
    <dt>Type</dt>
    <dd>DOMElement</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _lastSelected = null;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_mouseupTimeoutId</h4>

    
<dl>
    <dt>Type</dt>
    <dd>Number</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _mouseupTimeoutId = null;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_projectBaseUrl</h4>

    
<dl>
    <dt>See</dt>
    <dd><a href='#'>getBaseUrl(), setBaseUrl()</a></dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _projectBaseUrl = &quot;&quot;;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_projectInitialLoad</h4>

    
<dl>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _projectInitialLoad = null;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_projectRoot</h4>

    
<dl>
    <dt>See</dt>
    <dd><a href='#'>getProjectRoot()</a></dd>
    <dt>Type</dt>
    <dd>Directory</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _projectRoot = null;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_projectTree</h4>

    
<dl>
    <dt>Type</dt>
    <dd>jQueryObject</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _projectTree = null;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_projectTreeSortComparator</h4>

    
<dl>
    <dt>Private</dt>
</dl>
    <div class="description"><p>A memoized comparator of DOM nodes for use with jsTree</p>
</div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _projectTreeSortComparator = _.memoize(function (a, b) {
        var a1 = $(a).data(&quot;compareString&quot;),
            b1 = $(b).data(&quot;compareString&quot;);
        
        return FileUtils.compareFilenames(a1, b1, false);
    }, function (a, b) {
        return $(a).data(&quot;compareString&quot;) + &quot;:&quot; + $(b).data(&quot;compareString&quot;);
    });</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_refreshDelay</h4>

    
<dl>
    <dt>Type</dt>
    <dd>number</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _refreshDelay = 1000;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_refreshFileTreePromise</h4>

    
<dl>
    <dt>Type</dt>
    <dd>?jQuery.Promise</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _refreshFileTreePromise = null;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_refreshPending</h4>

    
<dl>
    <dt>Type</dt>
    <dd>boolean</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _refreshPending = false;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_sortPrefixDir</h4>

    
<dl>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _sortPrefixDir,
        _sortPrefixFile;</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_suppressSelectionChange</h4>

    
<dl>
    <dt>Type</dt>
    <dd>boolean</dd>
    <dt>Private</dt>
</dl>
    <div class="description"></div>

<button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    var _suppressSelectionChange = false;</code></pre></div>
</section>

<section id="functions">

    <h3>Functions 
<label class="checkbox">
    <input class="toggle-public" type="checkbox"> Show Private Members
</label>    </h3>

<div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_checkForValidFilename</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>filename</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd></dd>
    <dt>isFolder</dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>Returns true if no illegal characters are found</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _checkForValidFilename(filename, isFolder) {
        &#x2F;&#x2F; Validate file name
        &#x2F;&#x2F; Checks for valid Windows filenames:
        &#x2F;&#x2F; See http:&#x2F;&#x2F;msdn.microsoft.com&#x2F;en-us&#x2F;library&#x2F;windows&#x2F;desktop&#x2F;aa365247(v=vs.85).aspx
        if ((filename.search(new RegExp(&quot;[&quot; + _invalidChars + &quot;]+&quot;)) !== -1) ||
                filename.match(_illegalFilenamesRegEx)) {
            Dialogs.showModalDialog(
                DefaultDialogs.DIALOG_ID_ERROR,
                StringUtils.format(Strings.INVALID_FILENAME_TITLE, isFolder ? Strings.DIRECTORY_NAME : Strings.FILENAME),
                StringUtils.format(Strings.INVALID_FILENAME_MESSAGE, isFolder ? Strings.DIRECTORY_NAMES_LEDE : Strings.FILENAMES_LEDE,  _invalidChars)
            );
            return false;
        }
        return true;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_checkPreferencePrefix</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>key</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>The key of the preference to be examined for migration of project tree states.</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">?string</dd>
    <dd>- the scope to which the preference is to be migrated</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _checkPreferencePrefix(key) {
        var pathPrefix = &quot;projectTreeState_&quot;,
            projectPath;
        if (key.indexOf(pathPrefix) === 0) {
            &#x2F;&#x2F; Get the project path from the old preference key by stripping &quot;projectTreeState_&quot;.
            projectPath = key.substr(pathPrefix.length);
            return &quot;user project.treeState &quot; + projectPath;
        }
        
        pathPrefix = &quot;projectBaseUrl_&quot;;
        if (key.indexOf(pathPrefix) === 0) {
            &#x2F;&#x2F; Get the project path from the old preference key by stripping &quot;projectBaseUrl_[Directory &quot;
            &#x2F;&#x2F; and &quot;]&quot;.
            projectPath = key.substr(key.indexOf(&quot; &quot;) + 1);
            projectPath = projectPath.substr(0, projectPath.length - 1);
            return &quot;user project.baseUrl &quot; + projectPath;
        }

        return null;
    }
    
    &#x2F;&#x2F; Init default project path to welcome project
    PreferencesManager.stateManager.definePreference(&quot;projectPath&quot;, &quot;string&quot;, _getWelcomeProjectPath());

    PreferencesManager.convertPreferences(module, {
        &quot;projectPath&quot;: &quot;user&quot;,
        &quot;projectTreeState_&quot;: &quot;user&quot;,
        &quot;welcomeProjects&quot;: &quot;user&quot;,
        &quot;projectBaseUrl_&quot;: &quot;user&quot;
    }, true, _checkPreferencePrefix);
    
    &#x2F;&#x2F; Initialize the sort prefixes and make sure to change them when the sort pref changes
    _generateSortPrefixes();
    PreferencesManager.on(&quot;change&quot;, &quot;sortDirectoriesFirst&quot;, function () {
        if (_generateSortPrefixes()) {
            refreshFileTree();
        }
    });
    
    &#x2F;&#x2F; Event Handlers
    $(FileViewController).on(&quot;documentSelectionFocusChange&quot;, _documentSelectionFocusChange);
    $(FileViewController).on(&quot;fileViewFocusChange&quot;, _fileViewFocusChange);
    $(exports).on(&quot;beforeAppClose&quot;, _unwatchProjectRoot);
    
    &#x2F;&#x2F; Commands
    CommandManager.register(Strings.CMD_OPEN_FOLDER,      Commands.FILE_OPEN_FOLDER,      openProject);
    CommandManager.register(Strings.CMD_PROJECT_SETTINGS, Commands.FILE_PROJECT_SETTINGS, _projectSettings);
    CommandManager.register(Strings.CMD_FILE_REFRESH,     Commands.FILE_REFRESH,          refreshFileTree);
    
    &#x2F;&#x2F; Init invalid characters string 
    if (brackets.platform === &quot;mac&quot;) {
        _invalidChars = &quot;?*|:&quot;;
    } else if (brackets.platform === &quot;linux&quot;) {
        _invalidChars = &quot;?*|&#x2F;&quot;;
    } else {
        _invalidChars = &quot;&#x2F;?*:&lt;&gt;\\|\&quot;&quot;;  &#x2F;&#x2F; invalid characters on Windows
    }

    &#x2F;&#x2F; Define public API
    exports.getProjectRoot           = getProjectRoot;
    exports.getBaseUrl               = getBaseUrl;
    exports.setBaseUrl               = setBaseUrl;
    exports.isWithinProject          = isWithinProject;
    exports.makeProjectRelativeIfPossible = makeProjectRelativeIfPossible;
    exports.shouldShow               = shouldShow;
    exports.isBinaryFile             = isBinaryFile;
    exports.openProject              = openProject;
    exports.getSelectedItem          = getSelectedItem;
    exports.getInitialProjectPath    = getInitialProjectPath;
    exports.isWelcomeProjectPath     = isWelcomeProjectPath;
    exports.updateWelcomeProjectPath = updateWelcomeProjectPath;
    exports.createNewItem            = createNewItem;
    exports.renameItemInline         = renameItemInline;
    exports.deleteItem               = deleteItem;
    exports.forceFinishRename        = forceFinishRename;
    exports.showInTree               = showInTree;
    exports.refreshFileTree          = refreshFileTree;
    exports.getAllFiles              = getAllFiles;
    exports.getLanguageFilter        = getLanguageFilter;
});</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_convertEntriesToJSON</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>entries</dt>
    <dd class="label label-info pull-left">Array.&lt;FileSystemEntry&gt;</dd>
    <dd>Array of FileSystemEntry entry objects.</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">Array</dd>
    <dd>jsTree node data: array of JSON objects</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _convertEntriesToJSON(entries) {
        var jsonEntryList = [],
            entry,
            entryI,
            jsonEntry;

        for (entryI = 0; entryI &lt; entries.length; entryI++) {
            jsonEntryList.push(_entryToJSON(entries[entryI]));
        }
        
        return jsonEntryList;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_createNode</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>$target</dt>
    <span class="label label-nullable pull-left">nullable</span>
    <dd class="label label-info pull-left">jQueryObject</dd>
    <dd>Parent or sibling node</dd>
    <dt>position</dt>
    <span class="label label-nullable pull-left">nullable</span>
    <dd class="label label-info pull-left">number, string</dd>
    <dd>Position to insert</dd>
    <dt>arr</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">Object, Array.&lt;Object&gt;</dd>
    <dd>Node data or array of node data</dd>
    <dt>skipRename</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">boolean</dd>
    <dd></dd>
    <dt>skipRedraw</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">boolean</dd>
    <dd></dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _createNode($target, position, arr, skipRename, skipRedraw) {
        if (typeof arr === &quot;string&quot;) {
            arr = [{ data: arr }];
        } else if (!Array.isArray(arr)) {
            arr = [arr];
        }
        
        position = position || 0;
        
        arr.forEach(function (node) {
            &#x2F;&#x2F; Convert strings to objects
            if (typeof node === &quot;string&quot;) {
                node = {
                    data: node,
                    metadata: { compareString: _sortPrefixFile + node }
                };
            }
            
            if (node) {
                _projectTree.jstree(&quot;create&quot;, $target, position, node, null, skipRename);
            }
        });
        
        if (!skipRedraw) {
            _redraw(true);
        }
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_deleteTreeNode</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>target</dt>
    <dd class="label label-info pull-left">FileSystemEntry,Array.&lt;FileSystemEntry&gt;</dd>
    <dd>Entry or array of entries to delete</dd>
    <dt>skipRedraw</dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd></dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _deleteTreeNode(target, skipRedraw) {
        var arr = !Array.isArray(target) ? [target] : target,
            oldSuppressToggleOpen = suppressToggleOpen,
            treeAPI = $.jstree._reference(_projectTree);
        
        suppressToggleOpen = true;
        
        arr.forEach(function (entry) {
            var $treeNode = _getTreeNode(entry),
                parentEntry,
                parentNode,
                siblings,
                parentWasOpen = false;

            &#x2F;&#x2F; Save parent node open&#x2F;closed state for non-root nodes
            if (entry.parentPath) {
                parentEntry = FileSystem.getDirectoryForPath(entry.parentPath);
                parentNode  = (parentEntry !== getProjectRoot()) &amp;&amp; _getTreeNode(parentEntry);

                if (parentNode) {
                    parentWasOpen = parentNode.hasClass(&quot;jstree-open&quot;);
                }
            }
            
            if ($treeNode) {
                _projectTree.jstree(&quot;delete_node&quot;, $treeNode);
                _deleteTreeNodeCache(entry);
                
                if (parentNode) {
                    siblings    = treeAPI._get_children(parentNode);
                    
                    &#x2F;&#x2F; Make sure it didn&#39;t turn into a leaf node. This happens if
                    &#x2F;&#x2F; the only file in the directory was deleted
                    if (siblings.length === 0 &amp;&amp; parentNode.hasClass(&quot;jstree-leaf&quot;)) {
                        parentNode.removeClass(&quot;jstree-leaf jstree-open jstree-closed&quot;);

                        &#x2F;&#x2F; Only apply style if parent is a tree node (i.e. not project root)
                        if (parentWasOpen) {
                            parentNode.addClass(&quot;jstree-open&quot;);
                        } else {
                            parentNode.addClass(&quot;jstree-closed&quot;);
                        }
                    }
                }
            }
        });
        
        suppressToggleOpen = oldSuppressToggleOpen;
        
        if (!skipRedraw) {
            _redraw(true);
        }
        
        &#x2F;&#x2F; Trigger notifications after tree updates are complete
        arr.forEach(function (entry) {
            if (DocumentManager.getCurrentDocument()) {
                DocumentManager.notifyPathDeleted(entry.fullPath);
            } else {
                EditorManager.notifyPathDeleted(entry.fullPath);
            }
        });
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_deleteTreeNodeCache</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">(FileSystemEntry, string)</dd>
    <dd>Entry or full path to remove from cache</dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _deleteTreeNodeCache(entry) {
        var fullPath = entry.fullPath || entry;
        delete _projectInitialLoad.fullPathToIdMap[fullPath];
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_ensureTrailingSlash</h4>

    
    <div class="description"><p>Although Brackets is generally standardized on folder paths with a trailing &quot;/&quot;, some APIs here
receive project paths without &quot;/&quot; due to legacy preference storage formats, etc.</p>
</div>
    
<dl>
    <dt>fullPath</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>Path that may or may not end in "/"</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">!string</dd>
    <dd>Path that ends in "/"</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _ensureTrailingSlash(fullPath) {
        if (fullPath[fullPath.length - 1] !== &quot;&#x2F;&quot;) {
            return fullPath + &quot;&#x2F;&quot;;
        }
        return fullPath;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_entryToJSON</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">FileSystemEntry</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">data: string,attr: {id: string},metadata: {entry: FileSystemEntry},children: Array.&lt;Object&gt;,state: string</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _entryToJSON(entry) {
        if (!shouldShow(entry)) {
            return null;
        }
        
        var jsonEntry = {
            data                : entry.name,
            attr                : { id: &quot;node&quot; + _projectInitialLoad.id++ },
            metadata: {
                entry           : entry,
                compareString   : _toCompareString(entry.name, entry.isDirectory)
            }
        };

        if (entry.isDirectory) {
            jsonEntry.children = [];
            jsonEntry.state = &quot;closed&quot;;
            jsonEntry.data = _.escape(jsonEntry.data);
        } else {
            jsonEntry.data = ViewUtils.getFileEntryDisplay(entry);
        }

        &#x2F;&#x2F; Map path to ID to initialize loaded and opened states
        _insertTreeNodeCache(entry, jsonEntry.attr.id);
        
        return jsonEntry;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_findTreeNode</h4>

    
    <div class="description"><p>Finds the tree node corresponding to the given file/folder (rejected if the path lies
outside the project, or if it doesn&#39;t exist).</p>
</div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">(File, Directory)</dd>
    <dd>File or Directory to find</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>Resolved with jQ obj for the jsTree tree node; or rejected if not found</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _findTreeNode(entry) {
        var result = new $.Deferred(),
            $renderedNode = _getTreeNode(entry);
        
        &#x2F;&#x2F; Check if tree node was already rendered
        if ($renderedNode) {
            return result.resolve($renderedNode).promise();
        }
        
        var projRelativePath = makeProjectRelativeIfPossible(entry.fullPath);

        if (projRelativePath === entry.fullPath) {
            &#x2F;&#x2F; If path not within project, ignore
            return result.reject().promise();
        } else if (entry === getProjectRoot()) {
            &#x2F;&#x2F; If path is the project root, return the tree itself
            return result.resolve($projectTreeList).promise();
        }
        
        var treeAPI = $.jstree._reference(_projectTree);
        
        &#x2F;&#x2F; We&#39;re going to traverse from root of tree, one segment at a time
        var pathSegments = projRelativePath.split(&quot;&#x2F;&quot;);
        if (entry.isDirectory) {
            pathSegments.pop();  &#x2F;&#x2F; Directory always has a trailing &quot;&#x2F;&quot;
        }
        
        function findInSubtree($nodes, segmentI) {
            var seg = pathSegments[segmentI];
            var match = _.findIndex($nodes, function (node, i) {
                var entry = $(node).data(&quot;entry&quot;),
                    nodeName = entry ? entry.name : null;
                
                return nodeName === seg;
            });
            
            if (match === -1) {
                result.reject();    &#x2F;&#x2F; path doesn&#39;t exist
            } else {
                var $node = $nodes.eq(match);
                if (segmentI === pathSegments.length - 1) {
                    result.resolve($node);  &#x2F;&#x2F; done searching!
                } else {
                    &#x2F;&#x2F; Search next level down
                    var subChildren = treeAPI._get_children($node);
                    if (subChildren.length &gt; 0) {
                        findInSubtree(subChildren, segmentI + 1);
                    } else {
                        &#x2F;&#x2F; Subtree not loaded yet: force async load &amp; try again
                        treeAPI.load_node($node, function (data) {
                            subChildren = treeAPI._get_children($node);
                            findInSubtree(subChildren, segmentI + 1);
                        }, function (err) {
                            result.reject();  &#x2F;&#x2F; includes case where folder is empty
                        });
                    }
                }
            }
        }
        
        &#x2F;&#x2F; Begin searching from root
        var topLevelNodes = treeAPI._get_children(-1);  &#x2F;&#x2F; -1 means top level in jsTree-ese
        findInSubtree(topLevelNodes, 0);
        
        return result.promise();
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_forceSelection</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _forceSelection(current, target) {
        &#x2F;&#x2F; select_node will force the target to be revealed. Instead,
        &#x2F;&#x2F; keep the scroller position stable.
        var savedScrollTop = $projectTreeContainer.get(0).scrollTop;
        
        &#x2F;&#x2F; suppress selectionChanged event from firing by jstree select_node
        _suppressSelectionChange = true;
        if (current) {
            _projectTree.jstree(&quot;deselect_node&quot;, current);
        }
        _projectTree.jstree(&quot;select_node&quot;, target, false);
        _suppressSelectionChange = false;
        
        $projectTreeContainer.get(0).scrollTop = savedScrollTop;
        
        _redraw(true, false);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_generateSortPrefixes</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>true if the sort prefixes have changed</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _generateSortPrefixes() {
        var previousDirFirst  = _dirFirst;
        _dirFirst             = PreferencesManager.get(&quot;sortDirectoriesFirst&quot;);
        _sortPrefixDir        = _dirFirst ? &quot;0&quot; : &quot;&quot;;
        _sortPrefixFile       = _dirFirst ? &quot;1&quot; : &quot;&quot;;
        
        return previousDirFirst !== _dirFirst;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getAllFilesCache</h4>

    
    <div class="description"><p>Returns a promise that resolves with a cached copy of all project files.
Used by ProjectManager.getAllFiles(). Ensures that at most one un-cached
directory traversal is active at a time, which is useful at project load
time when watchers (and hence filesystem-level caching) has not finished
starting up. The cache is cleared on every filesystem change event, and
also on project load and unload.</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">jQuery.Promise.&lt;Array.&lt;File&gt;&gt;</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getAllFilesCache() {
        if (!_allFilesCachePromise) {
            var deferred = new $.Deferred(),
                allFiles = [],
                allFilesVisitor = function (entry) {
                    if (shouldShow(entry)) {
                        if (entry.isFile) {
                            allFiles.push(entry);
                        }
                        return true;
                    }
                    return false;
                };

            _allFilesCachePromise = deferred.promise();
            
            getProjectRoot().visit(allFilesVisitor, function (err) {
                if (err) {
                    deferred.reject();
                    _allFilesCachePromise = null;
                } else {
                    deferred.resolve(allFiles);
                }
            });
        }
        
        return _allFilesCachePromise;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getTreeNode</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">File, Directory, string</dd>
    <dd>String or File/Directory entry to find in the tree</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">?jQuery</dd>
    <dd>The jQuery node for this entry or null if not found</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getTreeNode(entry) {
        &#x2F;&#x2F; Special case if the entry matches the project root
        if (entry === getProjectRoot()) {
            return $projectTreeList;
        }
        
        var fullPath = entry.fullPath || entry,
            id = _projectInitialLoad.fullPathToIdMap[fullPath],
            node = null;
        
        if (id) {
            node = $(&quot;#&quot; + id);
        }
        
        return node;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getTreeSelectedItem</h4>

    
    <div class="description"><p>Returns the File or Directory corresponding to the item selected in the file tree, or null
if no item is selected in the tree (though the working set may still have a selection; use
getSelectedItem() to get the selection regardless of whether it&#39;s in the tree or working set).</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">?(File,Directory)</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getTreeSelectedItem() {
        var selected = _projectTree.jstree(&quot;get_selected&quot;);
        if (selected) {
            return selected.data(&quot;entry&quot;);
        }
        return null;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getWelcomeProjectPath</h4>

    
    <div class="description"><p>Returns the full path to the welcome project, which we open on first launch.</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">!string</dd>
    <dd>fullPath reference</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getWelcomeProjectPath() {
        var initialPath = FileUtils.getNativeBracketsDirectoryPath(),
            sampleUrl = Urls.GETTING_STARTED;
        if (sampleUrl) {
            &#x2F;&#x2F; Back up one more folder. The samples folder is assumed to be at the same level as
            &#x2F;&#x2F; the src folder, and the sampleUrl is relative to the samples folder.
            initialPath = initialPath.substr(0, initialPath.lastIndexOf(&quot;&#x2F;&quot;)) + &quot;&#x2F;samples&#x2F;&quot; + sampleUrl;
        }

        return _ensureTrailingSlash(initialPath); &#x2F;&#x2F; paths above weren&#39;t canonical
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_hasFileSelectionFocus</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _hasFileSelectionFocus() {
        return FileViewController.getFileSelectionFocus() === FileViewController.PROJECT_MANAGER;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_insertTreeNodeCache</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">(FileSystemEntry, string)</dd>
    <dd>Entry or full path to add to cache</dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _insertTreeNodeCache(entry, id) {
        var fullPath = entry.fullPath || entry;
        _projectInitialLoad.fullPathToIdMap[fullPath] = id;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_isInRename</h4>

    
    <div class="description"><p>Returns false when the event occured without any input present in the li closest to the DOM object</p>
</div>
    
<dl>
    <dt>event</dt>
    <dd class="label label-info pull-left">event</dd>
    <dd>to check</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>true if an input field is present</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _isInRename(element) {
        return ($(element).closest(&quot;li&quot;).find(&quot;input&quot;).length &gt; 0);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_loadProject</h4>

    
    <div class="description"><p>Loads the given folder as a project. Normally, you would call openProject() instead to let the
user choose a folder.</p>
</div>
    
<dl>
    <dt>rootPath</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>Absolute path to the root folder of the project. A trailing "/" on the path is optional (unlike many Brackets APIs that assume a trailing "/").</dd>
    <dt>isUpdating</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>If true, indicates we're just updating the tree; if false, a different project is being loaded.</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>A promise object that will be resolved when the project is loaded and tree is rendered, or rejected if the project path fails to load.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _loadProject(rootPath, isUpdating) {
        var result = new $.Deferred(),
            startLoad = new $.Deferred(),
            resultRenderTree;

        forceFinishRename();    &#x2F;&#x2F; in case we&#39;re in the middle of renaming a file in the project
        
        &#x2F;&#x2F; Some legacy code calls this API with a non-canonical path
        rootPath = _ensureTrailingSlash(rootPath);
        
        if (isUpdating) {
            &#x2F;&#x2F; We&#39;re just refreshing. Don&#39;t need to unwatch the project root, so we can start loading immediately.
            startLoad.resolve();
        } else {
            if (_projectRoot &amp;&amp; _projectRoot.fullPath === rootPath) {
                return (new $.Deferred()).resolve().promise();
            }
            
            &#x2F;&#x2F; About to close current project (if any)
            if (_projectRoot) {
                $(exports).triggerHandler(&quot;beforeProjectClose&quot;, _projectRoot);
            }
            
            &#x2F;&#x2F; close all the old files
            DocumentManager.closeAll();
    
            _unwatchProjectRoot().always(function () {
                &#x2F;&#x2F; Done closing old project (if any)
                if (_projectRoot) {
                    $(exports).triggerHandler(&quot;projectClose&quot;, _projectRoot);
                }
                
                startLoad.resolve();
            });
        }
        
        startLoad.done(function () {
            var context = { location : { scope: &quot;user&quot;,
                                         layer: &quot;project&quot; } };

            &#x2F;&#x2F; Clear project path map
            _projectInitialLoad = {
                previous        : [],</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_projectSettings</h4>

    
    <div class="description"><p>Invoke project settings dialog.</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _projectSettings() {
        return PreferencesDialogs.showProjectPreferencesDialog(getBaseUrl()).getPromise();
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_redraw</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _redraw(selectionChanged, reveal) {
        reveal = (reveal === undefined) ? true : reveal;
        
        &#x2F;&#x2F; redraw selection
        if ($projectTreeList) {
            if (selectionChanged &amp;&amp; !_suppressSelectionChange) {
                $projectTreeList.triggerHandler(&quot;selectionChanged&quot;, reveal);
            }

            &#x2F;&#x2F; reposition the selection triangle
            $projectTreeContainer.triggerHandler(&quot;selectionRedraw&quot;);
            
            &#x2F;&#x2F; in-lieu of resize events, manually trigger contentChanged for every
            &#x2F;&#x2F; FileViewController focus change. This event triggers scroll shadows
            &#x2F;&#x2F; on the jstree to update. documentSelectionFocusChange fires when
            &#x2F;&#x2F; a new file is added and removed (causing a new selection) from the working set
            _projectTree.triggerHandler(&quot;contentChanged&quot;);
        }
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_refreshFileTreeInternal</h4>

    
    <div class="description"><p>Internal function to refresh the project&#39;s file tree, maintaining the
current selection. This function is expensive and not concurrency-safe,
so most callers should use the synchronized and throttled version below,
refreshFileTree.</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>A promise object that will be resolved when the project tree is reloaded, or rejected if the project path fails to reload. If the previous selected entry is not found, the promise is still resolved.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _refreshFileTreeInternal() {
        var selectedEntry,
            deferred = new $.Deferred();

        if (_lastSelected) {
            selectedEntry = _lastSelected.data(&quot;entry&quot;);
        }
        _lastSelected = null;
        
        _loadProject(getProjectRoot().fullPath, true)
            .then(function () {
                if (selectedEntry) {
                    &#x2F;&#x2F; restore selection, always resolve
                    _findTreeNode(selectedEntry)
                        .done(function ($node) {
                            _forceSelection(null, $node);
                        })
                        .always(deferred.resolve);
                } else {
                    deferred.resolve();
                }
            }, deferred.reject);

        return deferred.promise();
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_reloadProjectPreferencesScope</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _reloadProjectPreferencesScope() {
        var root = getProjectRoot();
        if (root) {
            &#x2F;&#x2F; Alias the &quot;project&quot; Scope to the path Scope for the project-level settings file
            PreferencesManager._setProjectSettingsFile(root.fullPath + SETTINGS_FILENAME);
        } else {
            PreferencesManager._setProjectSettingsFile();
        }
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_renderTree</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _renderTree(treeDataProvider) {
        var result = new $.Deferred();

        &#x2F;&#x2F; For #1542, make sure the tree is scrolled to the top before refreshing.
        &#x2F;&#x2F; If we try to do this later (e.g. after the tree has been refreshed), it
        &#x2F;&#x2F; doesn&#39;t seem to work properly.
        $projectTreeContainer.scrollTop(0);
        
        &#x2F;&#x2F; Instantiate tree widget
        &#x2F;&#x2F; (jsTree is smart enough to replace the old tree if there&#39;s already one there)
        $projectTreeContainer.hide()
            .addClass(&quot;no-focus&quot;);
        _projectTree = $projectTreeContainer
            .jstree({
                plugins : [&quot;ui&quot;, &quot;themes&quot;, &quot;json_data&quot;, &quot;crrm&quot;, &quot;sort&quot;],
                ui : { select_limit: 1, select_multiple_modifier: &quot;&quot;, select_range_modifier: &quot;&quot; },
                json_data : { data: treeDataProvider, correct_state: false },
                core : { html_titles: true, animation: 0, strings : { loading : Strings.PROJECT_LOADING, new_node : &quot;New node&quot; } },
                themes : { theme: &quot;brackets&quot;, url: &quot;styles&#x2F;jsTreeTheme.css&quot;, dots: false, icons: false },
                    &#x2F;&#x2F;(note: our actual jsTree theme CSS lives in brackets.less; we specify an empty .css
                    &#x2F;&#x2F; file because jsTree insists on loading one itself)
                sort : _projectTreeSortComparator
            }).bind(
                &quot;before.jstree&quot;,
                function (event, data) {
                    if (data.func === &quot;toggle_node&quot;) {
                        &#x2F;&#x2F; jstree will automaticaly select parent node when the parent is closed
                        &#x2F;&#x2F; and any descendant is selected. Prevent the select_node handler from
                        &#x2F;&#x2F; immediately toggling open again in this case.
                        suppressToggleOpen = _projectTree.jstree(&quot;is_open&quot;, data.args[0]);
                    }
                }
            ).bind(
                &quot;select_node.jstree&quot;,
                function (event, data) {
                    var entry = data.rslt.obj.data(&quot;entry&quot;);
                    if (entry) {
                        if (entry.isFile) {
                            var openResult = FileViewController.openAndSelectDocument(entry.fullPath, FileViewController.PROJECT_MANAGER);
                        
                            openResult.done(function () {
                                &#x2F;&#x2F; update when tree display state changes
                                _redraw(true);
                                _lastSelected = data.rslt.obj;
                            }).fail(function () {
                                if (_lastSelected) {
                                    &#x2F;&#x2F; revert this new selection and restore previous selection
                                    _forceSelection(data.rslt.obj, _lastSelected);
                                } else {
                                    _projectTree.jstree(&quot;deselect_all&quot;);
                                    _lastSelected = null;
                                }
                            });
                        } else {
                            FileViewController.setFileViewFocus(FileViewController.PROJECT_MANAGER);
                            &#x2F;&#x2F; show selection marker on folders
                            _redraw(true);
                            
                            &#x2F;&#x2F; toggle folder open&#x2F;closed
                            &#x2F;&#x2F; suppress if this selection was triggered by clicking the disclousre triangle
                            if (!suppressToggleOpen) {
                                _projectTree.jstree(&quot;toggle_node&quot;, data.rslt.obj);
                            }
                        }
                    }
                    suppressToggleOpen = false;
                }
            ).bind(
                &quot;reopen.jstree&quot;,
                function (event, data) {
                    if (_projectInitialLoad.previous) {
                        &#x2F;&#x2F; Start reopening nodes that were previously open, starting
                        &#x2F;&#x2F; with the first recorded depth level. As each level completes,
                        &#x2F;&#x2F; it will trigger the next level to finish.
                        _reopenNodes(_projectInitialLoad.previous, result);
                        _projectInitialLoad.previous = null;
                    }
                }
            ).bind(
                &quot;scroll.jstree&quot;,
                function (e) {
                    &#x2F;&#x2F; close all dropdowns on scroll
                    Menus.closeAll();
                }
            ).bind(
                &quot;loaded.jstree open_node.jstree close_node.jstree&quot;,
                function (event, data) {
                    if (event.type === &quot;open_node&quot;) {
                        &#x2F;&#x2F; select the current document if it becomes visible when this folder is opened
                        var curDoc = DocumentManager.getCurrentDocument();
                        
                        if (_hasFileSelectionFocus() &amp;&amp; curDoc &amp;&amp; data) {
                            var entry = data.rslt.obj.data(&quot;entry&quot;);
                            
                            if (entry &amp;&amp; curDoc.file.fullPath.indexOf(entry.fullPath) === 0) {
                                _forceSelection(data.rslt.obj, _lastSelected);
                            } else {
                                _redraw(true, false);
                            }
                        }
                    } else if (event.type === &quot;close_node&quot;) {
                        &#x2F;&#x2F; always update selection marker position when collapsing a node
                        _redraw(true, false);
                    } else {
                        _redraw(false);
                    }
                    
                    _savePreferences();
                }
            ).bind(
                &quot;mousedown.jstree&quot;,
                function (event) {
                    &#x2F;&#x2F; select tree node on right-click
                    if (event.which === 3 || (event.ctrlKey &amp;&amp; event.which === 1 &amp;&amp; brackets.platform === &quot;mac&quot;)) {
                        var treenode = $(event.target).closest(&quot;li&quot;);
                        if (treenode) {
                            var saveSuppressToggleOpen = suppressToggleOpen;
                            
                            &#x2F;&#x2F; don&#39;t toggle open folders (just select)
                            suppressToggleOpen = true;
                            _projectTree.jstree(&quot;deselect_all&quot;);
                            _projectTree.jstree(&quot;select_node&quot;, treenode, false);
                            suppressToggleOpen = saveSuppressToggleOpen;
                        }
                    }
                }
            ).bind(&quot;mouseup.jstree&quot;, function (event) {
                if (event.button !== 0) { &#x2F;&#x2F; 0 = Left mouse button
                    return;
                }

                var $treenode = $(event.target).closest(&quot;li&quot;),
                    entry = $treenode.data(&quot;entry&quot;);
                &#x2F;&#x2F; Don&#39;t do the rename for folders, because clicking on a folder name collapses&#x2F;expands it.
                if (entry &amp;&amp; entry.isFile &amp;&amp; $treenode.is($(_projectTree.jstree(&quot;get_selected&quot;)))) {
                    &#x2F;&#x2F; wrap this in a setTimeout function so that we can check if it&#39;s a double click.
                    _mouseupTimeoutId = window.setTimeout(function () {
                        &#x2F;&#x2F; if we get a double-click, _mouseupTimeoutId will have been set to null by the double-click handler before this runs.
                        if (_mouseupTimeoutId !== null) {
                            CommandManager.execute(Commands.FILE_RENAME);
                        }
                    }, 500);
                }
            });

        &#x2F;&#x2F; jstree has a default event handler for dblclick that attempts to clear the
        &#x2F;&#x2F; global window selection (presumably because it doesn&#39;t want text within the tree
        &#x2F;&#x2F; to be selected). This ends up messing up CodeMirror, and we don&#39;t need this anyway
        &#x2F;&#x2F; since we&#39;ve turned off user selection of UI text globally. So we just unbind it,
        &#x2F;&#x2F; and add our own double-click handler here.
        &#x2F;&#x2F; Filed this bug against jstree at https:&#x2F;&#x2F;github.com&#x2F;vakata&#x2F;jstree&#x2F;issues&#x2F;163
        _projectTree.bind(&quot;init.jstree&quot;, function () {
            &#x2F;&#x2F; install scroller shadows
            ViewUtils.addScrollerShadow(_projectTree.get(0));
            
            var findEventHandler = function (type, namespace, selector) {
                var events        = $._data(_projectTree[0], &quot;events&quot;),
                    eventsForType = events ? events[type] : null,
                    event         = eventsForType ? _.find(eventsForType, function (e) {
                        return e.namespace === namespace &amp;&amp; e.selector === selector;
                    }) : null,
                    eventHandler  = event ? event.handler : null;
                if (!eventHandler) {
                    console.error(type + &quot;.&quot; + namespace + &quot; &quot; + selector + &quot; handler not found!&quot;);
                }
                return eventHandler;
            };
            var createCustomHandler = function (originalHandler) {
                return function (event) {
                    var $node = $(event.target).parent(&quot;li&quot;),
                        methodName;
                    if (event.ctrlKey || event.metaKey) {
                        if (event.altKey) {
                            &#x2F;&#x2F; collapse subtree
                            &#x2F;&#x2F; note: expanding using open_all is a bad idea due to poor performance
                            methodName = $node.is(&quot;.jstree-open&quot;) ? &quot;close_all&quot; : &quot;open_node&quot;;
                            _projectTree.jstree(methodName, $node);
                            return;
                        } else {
                            &#x2F;&#x2F; toggle siblings
                            methodName = $node.is(&quot;.jstree-open&quot;) ? &quot;close_node&quot; : &quot;open_node&quot;;
                            $node.parent().children(&quot;li&quot;).each(function () {
                                _projectTree.jstree(methodName, $(this));
                            });
                            return;
                        }
                    }
                    &#x2F;&#x2F; original behaviour
                    originalHandler.apply(this, arguments);
                };
            };
            var originalHrefHandler = findEventHandler(&quot;click&quot;, &quot;jstree&quot;, &quot;a&quot;);
            var originalInsHandler = findEventHandler(&quot;click&quot;, &quot;jstree&quot;, &quot;li &gt; ins&quot;);

            _projectTree
                .off(&quot;click.jstree&quot;, &quot;a&quot;)
                .on(&quot;click.jstree&quot;, &quot;a&quot;, createCustomHandler(originalHrefHandler))
                .off(&quot;click.jstree&quot;, &quot;li &gt; ins&quot;)
                .on(&quot;click.jstree&quot;, &quot;li &gt; ins&quot;, createCustomHandler(originalInsHandler))
                .unbind(&quot;dblclick.jstree&quot;)
                .bind(&quot;dblclick.jstree&quot;, function (event) {
                    var entry = $(event.target).closest(&quot;li&quot;).data(&quot;entry&quot;);
                    if (entry &amp;&amp; entry.isFile &amp;&amp; !_isInRename(event.target)) {
                        FileViewController.addToWorkingSetAndSelect(entry.fullPath);
                    }
                    if (_mouseupTimeoutId !== null) {
                        window.clearTimeout(_mouseupTimeoutId);
                        _mouseupTimeoutId = null;
                    }
                    
                });

            &#x2F;&#x2F; fire selection changed events for sidebar-selection
            $projectTreeList = $projectTreeContainer.find(&quot;ul&quot;);
            ViewUtils.sidebarList($projectTreeContainer, &quot;jstree-clicked&quot;, &quot;jstree-leaf&quot;);
            $projectTreeContainer.show();
        });

        return Async.withTimeout(result.promise(), 1000);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_reopenNodes</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>nodesByDepth</dt>
    <dd class="label label-info pull-left">Array.&lt;Array.&lt;string&gt;&gt;</dd>
    <dd>An array of arrays of node ids to reopen. The ids within each sub-array are reopened in parallel, and the sub-arrays are reopened in order, so they should be sorted by depth within the tree.</dd>
    <dt>resultDeferred</dt>
    <dd class="label label-info pull-left">$.Deferred</dd>
    <dd>A Deferred that will be resolved when all nodes have been fully reopened.</dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _reopenNodes(nodesByDepth, resultDeferred) {
        if (nodesByDepth.length === 0) {
            &#x2F;&#x2F; All paths are opened and fully rendered.
            resultDeferred.resolve();
        } else {
            var toOpenPaths = nodesByDepth.shift(),
                toOpenIds   = [],
                node        = null;

            &#x2F;&#x2F; use path to lookup ID
            toOpenPaths.forEach(function (value, index) {
                node = _projectInitialLoad.fullPathToIdMap[value];
                
                if (node) {
                    toOpenIds.push(node);
                }
            });
            
            Async.doInParallel(
                toOpenIds,
                function (id) {
                    var result = new $.Deferred();
                    _projectTree.jstree(&quot;open_node&quot;, &quot;#&quot; + id, function () {
                        result.resolve();
                    }, true);
                    return result.promise();
                },
                false
            ).always(function () {
                _reopenNodes(nodesByDepth, resultDeferred);
            });
        }
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_savePreferences</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _savePreferences() {
        
        &#x2F;&#x2F; save the current project
        PreferencesManager.setViewState(&quot;projectPath&quot;, _projectRoot.fullPath);

        &#x2F;&#x2F; save jstree state
        var openNodes = [],
            projectPathLength = _projectRoot.fullPath.length,
            entry,
            fullPath,
            shortPath,
            depth,
            context = { location : { scope: &quot;user&quot;,
                                     layer: &quot;project&quot;,
                                     layerID: _projectRoot.fullPath } };

        &#x2F;&#x2F; Query open nodes by class selector
        $(&quot;.jstree-open:visible&quot;).each(function (index) {
            entry = $(this).data(&quot;entry&quot;);

            if (entry.fullPath) {
                fullPath = entry.fullPath;

                &#x2F;&#x2F; Truncate project path prefix (including its last slash) AND remove trailing slash suffix
                &#x2F;&#x2F; So &quot;&#x2F;foo&#x2F;bar&#x2F;projroot&#x2F;abc&#x2F;xyz&#x2F;&quot; -&gt; &quot;abc&#x2F;xyz&quot;
                shortPath = fullPath.slice(projectPathLength, -1);

                &#x2F;&#x2F; Determine depth of the node by counting path separators.
                &#x2F;&#x2F; Children at the root have depth of zero
                depth = shortPath.split(&quot;&#x2F;&quot;).length - 1;

                &#x2F;&#x2F; Map tree depth to list of open nodes
                if (openNodes[depth] === undefined) {
                    openNodes[depth] = [];
                }

                openNodes[depth].push(fullPath);
            }
        });

        &#x2F;&#x2F; Store the open nodes by their full path and persist to storage
        PreferencesManager.setViewState(&quot;project.treeState&quot;, openNodes, context);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_shouldShowName</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _shouldShowName(name) {
        return !name.match(_exclusionListRegEx);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_showMaxFilesDialog</h4>

    
    <div class="description"><p>Error dialog when max files in index is hit</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">Dialog</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _showMaxFilesDialog() {
        return Dialogs.showModalDialog(
            DefaultDialogs.DIALOG_ID_ERROR,
            Strings.ERROR_MAX_FILES_TITLE,
            Strings.ERROR_MAX_FILES
        );
    }
    
    function _watchProjectRoot(rootPath) {
        FileSystem.on(&quot;change&quot;, _fileSystemChange);
        FileSystem.on(&quot;rename&quot;, _fileSystemRename);

        FileSystem.watch(FileSystem.getDirectoryForPath(rootPath), _shouldShowName, function (err) {
            if (err === FileSystemError.TOO_MANY_ENTRIES) {
                _showMaxFilesDialog();
            } else if (err) {
                console.error(&quot;Error watching project root: &quot;, rootPath, err);
            }
        });
        
        &#x2F;&#x2F; Reset allFiles cache
        _allFilesCachePromise = null;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_toCompareString</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>name</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd></dd>
    <dt>isFolder</dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">string</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _toCompareString(name, isFolder) {
        return (isFolder ? _sortPrefixDir : _sortPrefixFile) + name;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_treeDataProvider</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>$treeNode</dt>
    <dd class="label label-info pull-left">jQueryObject</dd>
    <dd>jQ object for the DOM node being expanded</dd>
    <dt>jsTreeCallback</dt>
    <dd class="label label-info pull-left">function(Array)</dd>
    <dd>jsTree callback to provide children to</dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _treeDataProvider($treeNode, jsTreeCallback) {
        var dirEntry, isProjectRoot = false, deferred = new $.Deferred();
        
        function processEntries(entries) {
            var subtreeJSON = _convertEntriesToJSON(entries),
                wasNodeOpen = false,
                emptyDirectory = (subtreeJSON.length === 0);
            
            if (emptyDirectory) {
                if (!isProjectRoot) {
                    wasNodeOpen = $treeNode.hasClass(&quot;jstree-open&quot;);
                } else {
                    &#x2F;&#x2F; project root is a special case, add a placeholder
                    subtreeJSON.push({});
                }
            }
            
            jsTreeCallback(subtreeJSON);
            
            if (!isProjectRoot &amp;&amp; emptyDirectory) {
                &#x2F;&#x2F; If the directory is empty, force it to appear as an open or closed node.
                &#x2F;&#x2F; This is a workaround for issue #149 where jstree would show this node as a leaf.
                var classToAdd = (wasNodeOpen) ? &quot;jstree-closed&quot; : &quot;jstree-open&quot;;
                
                $treeNode.removeClass(&quot;jstree-leaf jstree-closed jstree-open&quot;)
                    .addClass(classToAdd);
                
                &#x2F;&#x2F; This is a workaround for a part of issue #2085, where the file creation process
                &#x2F;&#x2F; depends on the open_node.jstree event being triggered, which doesn&#39;t happen on
                &#x2F;&#x2F; empty folders
                if (!wasNodeOpen) {
                    $treeNode.trigger(&quot;open_node.jstree&quot;);
                }
            }
            
            deferred.resolve();
        }

        if ($treeNode === -1) {
            &#x2F;&#x2F; Special case: root of tree
            dirEntry = _projectRoot;
            isProjectRoot = true;
        } else {
            &#x2F;&#x2F; All other nodes: the Directory is saved as jQ data in the tree (by _convertEntriesToJSON())
            dirEntry = $treeNode.data(&quot;entry&quot;);
        }
        
        &#x2F;&#x2F; Fetch dirEntry&#39;s contents
        dirEntry.getContents(function (err, contents, stats, statsErrs) {
            if (err) {
                Dialogs.showModalDialog(
                    DefaultDialogs.DIALOG_ID_ERROR,
                    Strings.ERROR_LOADING_PROJECT,
                    StringUtils.format(
                        Strings.READ_DIRECTORY_ENTRIES_ERROR,
                        StringUtils.breakableUrl(dirEntry.fullPath),
                        err
                    )
                );
                &#x2F;&#x2F; Reject the render promise so we can move on.
                deferred.reject();
            } else {
                if (statsErrs) {
                    &#x2F;&#x2F; some but not all entries failed to load, so render what we can
                    console.warn(&quot;Error reading a subset of folder &quot; + dirEntry);
                }
                processEntries(contents);
            }
        });
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_unwatchProjectRoot</h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>A promise that's resolved when the root is unwatched. Rejected if there is no project root or if the unwatch fails.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _unwatchProjectRoot() {
        var result = new $.Deferred();
        if (!_projectRoot) {
            result.reject();
        } else {
            FileSystem.off(&quot;change&quot;, _fileSystemChange);
            FileSystem.off(&quot;rename&quot;, _fileSystemRename);

            FileSystem.unwatch(_projectRoot, function (err) {
                if (err) {
                    console.error(&quot;Error unwatching project root: &quot;, _projectRoot.fullPath, err);
                    result.reject();
                } else {
                    result.resolve();
                }
            });
            
            &#x2F;&#x2F; Reset allFiles cache
            _allFilesCachePromise = null;
        }
        
        return result.promise();
    }</code></pre></div><div class="member">

<span class="pull-right scope">
    
    
</span>
    <h4>addWelcomeProjectPath</h4>

    
    <div class="description"><p>Adds the path to the list of welcome projects we&#39;ve ever seen, if not on the list already.</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function addWelcomeProjectPath(path) {
        var pathNoSlash = FileUtils.stripTrailingSlash(path);  &#x2F;&#x2F; &quot;welcomeProjects&quot; pref has standardized on no trailing &quot;&#x2F;&quot;
        
        var welcomeProjects = PreferencesManager.getViewState(&quot;welcomeProjects&quot;) || [];
        if (welcomeProjects.indexOf(pathNoSlash) === -1) {
            welcomeProjects.push(pathNoSlash);
            PreferencesManager.setViewState(&quot;welcomeProjects&quot;, welcomeProjects);
        }
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>createNewItem</h4>

    
    <div class="description"><p>Create a new item in the current project.</p>
</div>
    
<dl>
    <dt>{string|Directory}</dt>
    <dd class="label label-info pull-left">baseDir</dd>
    <dd>Full path of the directory where the item should go. Defaults to the project root if the entry is not valid or not within the project.</dd>
    <dt>{string}</dt>
    <dd class="label label-info pull-left">initialName</dd>
    <dd>Initial name for the item</dd>
    <dt>{boolean}</dt>
    <dd class="label label-info pull-left">skipRename</dd>
    <dd>If true, don't allow the user to rename the item</dd>
    <dt>{boolean}</dt>
    <dd class="label label-info pull-left">isFolder</dd>
    <dd>If true, create a folder instead of a file</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>A promise object that will be resolved with the File of the created object, or rejected if the user cancelled or entered an illegal filename.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function createNewItem(baseDir, initialName, skipRename, isFolder) {
        &#x2F;&#x2F; We assume the parent directory exists
        var entry               = (typeof baseDir === &quot;string&quot;) ? FileSystem.getDirectoryForPath(baseDir) : baseDir,
            baseDirEntry        = isWithinProject(entry) ? entry : getProjectRoot(),
            $baseDirNode        = (baseDir &amp;&amp; _getTreeNode(baseDirEntry)) || null,
            position            = &quot;inside&quot;,
            escapeKeyPressed    = false,
            result              = new $.Deferred(),
            isRoot              = $baseDirNode === $projectTreeList,
            wasNodeOpen         = isRoot || ($baseDirNode &amp;&amp; $baseDirNode.hasClass(&quot;jstree-open&quot;)) || false,
            newItemData         = {};
        
        &#x2F;&#x2F; Silently fail if baseDir assumption fails
        if (!$baseDirNode) {
            return result.reject().promise();
        }
        
        &#x2F;&#x2F; Inject jstree data for sorting
        newItemData.data = initialName;
        newItemData.metadata = { compareString: _toCompareString(initialName, isFolder) };

        _projectTree.on(&quot;create.jstree&quot;, function (event, data) {
            $(event.target).off(&quot;create.jstree&quot;);

            function errorCleanup() {
                &#x2F;&#x2F; TODO (issue #115): If an error occurred, we should allow the user to fix the filename.
                &#x2F;&#x2F; For now we just remove the node so you have to start again.
                var parent = data.inst._get_parent(data.rslt.obj);
                
                _projectTree.jstree(&quot;remove&quot;, data.rslt.obj);
                
                &#x2F;&#x2F; Restore tree node state and styling when errors occur.
                &#x2F;&#x2F; parent returns -1 when at the root
                if (parent &amp;&amp; (parent !== -1)) {
                    var methodName = (wasNodeOpen) ? &quot;open_node&quot; : &quot;close_node&quot;;
                    var classToAdd = (wasNodeOpen) ? &quot;jstree-open&quot; : &quot;jstree-closed&quot;;

                    &#x2F;&#x2F; This is a workaround for issue #149 where jstree would show this node as a leaf.
                    _projectTree.jstree(methodName, parent);
                    parent.removeClass(&quot;jstree-leaf jstree-closed jstree-open&quot;)
                        .addClass(classToAdd);
                }
                
                _redraw(true);
                
                result.reject();
            }

            if (!escapeKeyPressed) {
                &#x2F;&#x2F; Validate file name
                if (!_checkForValidFilename(data.rslt.name, isFolder)) {
                    errorCleanup();
                    return;
                }

                var successCallback = function (entry) {
                    &#x2F;&#x2F; Remove the temporary leaf node used for the name input
                    _projectTree.jstree(&quot;remove&quot;, data.rslt.obj);

                    _projectTree.one(&quot;create.jstree&quot;, function (event, data) {
                        &#x2F;&#x2F; Select the new node and resolve
                        _projectTree.jstree(&quot;select_node&quot;, data.rslt.obj, true);
                        result.resolve(entry);
                    });

                    &#x2F;&#x2F; Create a new node
                    _createNode($baseDirNode, null, _entryToJSON(entry), true, true);
                };
                
                var errorCallback = function (error, entry) {
                    var titleType = isFolder ? Strings.DIRECTORY_NAME : Strings.FILENAME,
                        entryType = isFolder ? Strings.DIRECTORY : Strings.FILE;
                    if (error === FileSystemError.ALREADY_EXISTS) {
                        Dialogs.showModalDialog(
                            DefaultDialogs.DIALOG_ID_ERROR,
                            StringUtils.format(Strings.INVALID_FILENAME_TITLE, titleType),
                            StringUtils.format(Strings.ENTRY_WITH_SAME_NAME_EXISTS,
                                StringUtils.breakableUrl(data.rslt.name))
                        );
                    } else {
                        var errString = error === FileSystemError.NOT_WRITABLE ?
                                         Strings.NO_MODIFICATION_ALLOWED_ERR :
                                         StringUtils.format(Strings.GENERIC_ERROR, error);

                        Dialogs.showModalDialog(
                            DefaultDialogs.DIALOG_ID_ERROR,
                            StringUtils.format(Strings.ERROR_CREATING_FILE_TITLE, entryType),
                            StringUtils.format(Strings.ERROR_CREATING_FILE, entryType,
                                StringUtils.breakableUrl(data.rslt.name), errString)
                        );
                    }

                    errorCleanup();
                };
                
                var newItemPath = baseDirEntry.fullPath + data.rslt.name;
                
                FileSystem.resolve(newItemPath, function (err, item) {
                    if (!err) {
                        &#x2F;&#x2F; Item already exists, fail with error
                        errorCallback(FileSystemError.ALREADY_EXISTS, item);
                    } else {
                        if (isFolder) {
                            var directory = FileSystem.getDirectoryForPath(newItemPath);
                            
                            directory.create(function (err) {
                                if (err) {
                                    errorCallback(err);
                                } else {
                                    successCallback(directory);
                                }
                            });
                        } else {
                            &#x2F;&#x2F; Create an empty file
                            var file = FileSystem.getFileForPath(newItemPath);
                            
                            file.write(&quot;&quot;, function (err) {
                                if (err) {
                                    errorCallback(err);
                                } else {
                                    successCallback(file);
                                }
                            });
                        }
                    }
                });
                
            } else { &#x2F;&#x2F;escapeKeyPressed
                errorCleanup();
            }
        });

        &#x2F;&#x2F; There is a race condition in jstree if &quot;open_node&quot; and &quot;create&quot; are called in rapid
        &#x2F;&#x2F; succession and the node was not yet loaded. To avoid it, first open the node and wait
        &#x2F;&#x2F; for the open_node event before trying to create the new one. See #2085 for more details.
        if (wasNodeOpen) {
            _createNode($baseDirNode, position, newItemData, skipRename);

            if (!skipRename) {
                var $renameInput = _projectTree.find(&quot;.jstree-rename-input&quot;);
    
                $renameInput.on(&quot;keydown&quot;, function (event) {
                    &#x2F;&#x2F; Listen for escape key on keydown, so we can remove the node in the create.jstree handler above
                    if (event.keyCode === KeyEvent.DOM_VK_ESCAPE) {
    
                        escapeKeyPressed = true;
                    }
                });
    
                ViewUtils.scrollElementIntoView(_projectTree, $renameInput, true);
            }
        } else {
            _projectTree.one(&quot;open_node.jstree&quot;, function () {
                _createNode($baseDirNode, position, newItemData, skipRename);
            });
    
            &#x2F;&#x2F; Open the node before creating the new child
            _projectTree.jstree(&quot;open_node&quot;, $baseDirNode);
        }
        
        return result.promise();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>deleteItem</h4>

    
    <div class="description"><p>Delete file or directore from project</p>
</div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">(File, Directory)</dd>
    <dd>File or Directory to delete</dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function deleteItem(entry) {
        var result = new $.Deferred();

        entry.moveToTrash(function (err) {
            if (!err) {
                _deleteTreeNode(entry);
                result.resolve();
            } else {
                &#x2F;&#x2F; Show an error alert
                Dialogs.showModalDialog(
                    Dialogs.DIALOG_ID_ERROR,
                    Strings.ERROR_DELETING_FILE_TITLE,
                    StringUtils.format(
                        Strings.ERROR_DELETING_FILE,
                        _.escape(entry.fullPath),
                        FileUtils.getFileErrorString(err)
                    )
                );
    
                result.reject(err);
            }
        });

        return result.promise();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>forceFinishRename</h4>

    
    <div class="description"><p>Forces createNewItem() to complete by removing focus from the rename field which causes
the new file to be written to disk</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function forceFinishRename() {
        $(&quot;.jstree-rename-input&quot;).blur();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getAllFiles</h4>

    
    <div class="description"><p>Returns an Array of all files for this project, optionally including
files in the working set that are <em>not</em> under the project root. Files filtered
out by shouldShow().</p>
</div>
    
<dl>
    <dt>filter</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">function (File, number):boolean</dd>
    <dd>Optional function to filter the file list (does not filter directory traversal). API matches Array.filter().</dd>
    <dt>includeWorkingSet</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>If true, include files in the working set that are not under the project root (*except* for untitled documents). </dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>Promise that is resolved with an Array of File objects.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getAllFiles(filter, includeWorkingSet) {
        &#x2F;&#x2F; The filter and includeWorkingSet params are both optional.
        &#x2F;&#x2F; Handle the case where filter is omitted but includeWorkingSet is
        &#x2F;&#x2F; specified.
        if (includeWorkingSet === undefined &amp;&amp; typeof (filter) !== &quot;function&quot;) {
            includeWorkingSet = filter;
            filter = null;
        }
        
        var filteredFilesDeferred = new $.Deferred();
        
        &#x2F;&#x2F; First gather all files in project proper
        _getAllFilesCache().done(function (result) {
            &#x2F;&#x2F; Add working set entries, if requested
            if (includeWorkingSet) {
                DocumentManager.getWorkingSet().forEach(function (file) {
                    if (result.indexOf(file) === -1 &amp;&amp; !(file instanceof InMemoryFile)) {
                        result.push(file);
                    }
                });
            }
            
            &#x2F;&#x2F; Filter list, if requested
            if (filter) {
                result = result.filter(filter);
            }
            
            &#x2F;&#x2F; If a done handler attached to the returned filtered files promise
            &#x2F;&#x2F; throws an exception that isn&#39;t handled here then it will leave
            &#x2F;&#x2F; _allFilesCachePromise in an inconsistent state such that no
            &#x2F;&#x2F; additional done handlers will ever be called!
            try {
                filteredFilesDeferred.resolve(result);
            } catch (e) {
                console.warn(&quot;Unhandled exception in getAllFiles handler: &quot;, e);
            }
        });
        
        return filteredFilesDeferred.promise();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getBaseUrl</h4>

    
    <div class="description"><p>Returns the encoded Base URL of the currently loaded project, or empty string if no project
is open (during startup, or running outside of app shell).</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">String</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getBaseUrl() {
        return _projectBaseUrl;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getInitialProjectPath</h4>

    
    <div class="description"><p>Initial project path is stored in prefs, which defaults to the welcome project on
first launch.</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getInitialProjectPath() {
        return updateWelcomeProjectPath(PreferencesManager.getViewState(&quot;projectPath&quot;));
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getLanguageFilter</h4>

    
    <div class="description"><p>Returns a filter for use with getAllFiles() that filters files based on LanguageManager language id</p>
</div>
    
<dl>
    <dt>languageId</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">!function(File):boolean</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getLanguageFilter(languageId) {
        return function languageFilter(file) {
            return (LanguageManager.getLanguageForPath(file.fullPath).getId() === languageId);
        };
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getProjectRoot</h4>

    
    <div class="description"><p>Returns the root folder of the currently loaded project, or null if no project is open (during
startup, or running outside of app shell).</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">Directory</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getProjectRoot() {
        return _projectRoot;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getSelectedItem</h4>

    
    <div class="description"><p>Returns the File or Directory corresponding to the item selected in the sidebar panel, whether in
the file tree OR in the working set; or null if no item is selected anywhere in the sidebar.
May NOT be identical to the current Document - a folder may be selected in the sidebar, or the sidebar may not
have the current document visible in the tree &amp; working set.</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">?(File,Directory)</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getSelectedItem() {
        &#x2F;&#x2F; Prefer file tree selection, else use working set selection
        var selectedEntry = _getTreeSelectedItem();
        if (!selectedEntry) {
            var doc = DocumentManager.getCurrentDocument();
            selectedEntry = (doc &amp;&amp; doc.file);
        }
        return selectedEntry;
    }

    function _fileViewFocusChange() {
        _redraw(true);
    }
    
    function _documentSelectionFocusChange() {
        var curFile = EditorManager.getCurrentlyViewedPath();
        if (curFile &amp;&amp; _hasFileSelectionFocus()) {
            var nodeFound = $(&quot;#project-files-container li&quot;).is(function (index) {
                var $treeNode = $(this),
                    entry = $treeNode.data(&quot;entry&quot;);
                if (entry &amp;&amp; entry.fullPath === curFile) {
                    if (!_projectTree.jstree(&quot;is_selected&quot;, $treeNode)) {
                        if ($treeNode.parents(&quot;.jstree-closed&quot;).length) {
                            &#x2F;&#x2F;don&#39;t auto-expand tree to show file - but remember it if parent is manually expanded later
                            _projectTree.jstree(&quot;deselect_all&quot;);
                            _lastSelected = $treeNode;
                        } else {
                            &#x2F;&#x2F;we don&#39;t want to trigger another selection change event, so manually deselect
                            &#x2F;&#x2F;and select without sending out notifications
                            _projectTree.jstree(&quot;deselect_all&quot;);
                            _projectTree.jstree(&quot;select_node&quot;, $treeNode, false);  &#x2F;&#x2F; sets _lastSelected
                        }
                    }
                    return true;
                }
                return false;
            });
            
            &#x2F;&#x2F; file is outside project subtree, or in a folder that&#39;s never been expanded yet
            if (!nodeFound) {
                _projectTree.jstree(&quot;deselect_all&quot;);
                _lastSelected = null;
            }
        } else if (_projectTree !== null) {
            _projectTree.jstree(&quot;deselect_all&quot;);
            _lastSelected = null;
        }
        
        _redraw(true);
    }</code></pre></div><div class="member public deprecated">

<span class="pull-right scope">
    
    Public API
</span>
    <h4><span class="label label-deprecated label-inverse">deprecated</span>isBinaryFile</h4>

<div class="alert alert-error">Use LanguageManager.getLanguageForPath(fullPath).isBinary()</div>
    
    <div class="description"><p>Returns true if fileName&#39;s extension doesn&#39;t belong to binary (e.g. archived)</p>
</div>
    
<dl>
    <dt>fileName</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function isBinaryFile(fileName) {
        DeprecationWarning.deprecationWarning(&quot;ProjectManager.isBinaryFile() called for &quot; + fileName + &quot;. Use LanguageManager.getLanguageForPath(fileName).isBinary() instead.&quot;);
        return LanguageManager.getLanguageForPath(fileName).isBinary();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>isWelcomeProjectPath</h4>

    
    <div class="description"><p>Returns true if the given path is the same as one of the welcome projects we&#39;ve previously opened,
or the one for the current build.</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function isWelcomeProjectPath(path) {
        if (path === _getWelcomeProjectPath()) {
            return true;
        }
        var pathNoSlash = FileUtils.stripTrailingSlash(path);  &#x2F;&#x2F; &quot;welcomeProjects&quot; pref has standardized on no trailing &quot;&#x2F;&quot;
        var welcomeProjects = PreferencesManager.getViewState(&quot;welcomeProjects&quot;) || [];
        return welcomeProjects.indexOf(pathNoSlash) !== -1;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>isWithinProject</h4>

    
    <div class="description"><p>Returns true if absPath lies within the project, false otherwise.
Does not support paths containing &quot;..&quot;</p>
</div>
    
<dl>
    <dt>absPathOrEntry</dt>
    <dd class="label label-info pull-left">string,FileSystemEntry</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function isWithinProject(absPathOrEntry) {
        var absPath = absPathOrEntry.fullPath || absPathOrEntry;
        return (_projectRoot &amp;&amp; absPath.indexOf(_projectRoot.fullPath) === 0);
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>makeProjectRelativeIfPossible</h4>

    
    <div class="description"><p>If absPath lies within the project, returns a project-relative path. Else returns absPath
unmodified.
Does not support paths containing &quot;..&quot;</p>
</div>
    
<dl>
    <dt>absPath</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">!string</dd>
    <dd></dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function makeProjectRelativeIfPossible(absPath) {
        if (isWithinProject(absPath)) {
            return absPath.slice(_projectRoot.fullPath.length);
        }
        return absPath;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>openProject</h4>

    
    <div class="description"><p>Open a new project. Currently, Brackets must always have a project open, so
this method handles both closing the current project and opening a new project.</p>
</div>
    
<dl>
    <dt>path</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>Optional absolute path to the root folder of the project. If path is undefined or null, displays a dialog where the user can choose a folder to load. If the user cancels the dialog, nothing more happens.</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>A promise object that will be resolved when the project is loaded and tree is rendered, or rejected if the project path fails to load.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function openProject(path) {

        var result = new $.Deferred();

        &#x2F;&#x2F; Confirm any unsaved changes first. We run the command in &quot;prompt-only&quot; mode, meaning it won&#39;t
        &#x2F;&#x2F; actually close any documents even on success; we&#39;ll do that manually after the user also oks
        &#x2F;&#x2F; the folder-browse dialog.
        CommandManager.execute(Commands.FILE_CLOSE_ALL, { promptOnly: true })
            .done(function () {
                if (path) {
                    &#x2F;&#x2F; use specified path
                    _loadProject(path, false).then(result.resolve, result.reject);
                } else {
                    &#x2F;&#x2F; Pop up a folder browse dialog
                    FileSystem.showOpenDialog(false, true, Strings.CHOOSE_FOLDER, _projectRoot.fullPath, null, function (err, files) {
                        if (!err) {
                            &#x2F;&#x2F; If length == 0, user canceled the dialog; length should never be &gt; 1
                            if (files.length &gt; 0) {
                                &#x2F;&#x2F; Load the new project into the folder tree
                                _loadProject(files[0]).then(result.resolve, result.reject);
                            } else {
                                result.reject();
                            }
                        } else {
                            Dialogs.showModalDialog(
                                DefaultDialogs.DIALOG_ID_ERROR,
                                Strings.ERROR_LOADING_PROJECT,
                                StringUtils.format(Strings.OPEN_DIALOG_ERROR, err)
                            );
                            result.reject();
                        }
                    });
                }
            })
            .fail(function () {
                result.reject();
            });

        &#x2F;&#x2F; if fail, don&#39;t open new project: user canceled (or we failed to save its unsaved changes)
        return result.promise();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>refreshFileTree</h4>

    
    <div class="description"><p>Refresh the project&#39;s file tree, maintaining the current selection.</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>A promise object that will be resolved when the project tree is reloaded, or rejected if the project path fails to reload. If the previous selected entry is not found, the promise is still resolved.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function refreshFileTree() {
        if (!_refreshFileTreePromise) {
            var internalRefreshPromise  = _refreshFileTreeInternal(),
                deferred                = new $.Deferred();

            _refreshFileTreePromise = deferred.promise();
            
            _refreshFileTreePromise.always(function () {
                _refreshFileTreePromise = null;
                
                if (_refreshPending) {
                    _refreshPending = false;
                    refreshFileTree();
                }
            });

            &#x2F;&#x2F; Wait at least one second before resolving the promise
            window.setTimeout(function () {
                internalRefreshPromise.then(deferred.resolve, deferred.reject);
            }, _refreshDelay);
        } else {
            _refreshPending = true;
        }

        return _refreshFileTreePromise;
    }</code></pre></div><div class="member">

<span class="pull-right scope">
    
    
</span>
    <h4>renameItem</h4>

    
    <div class="description"><p>Rename a file/folder. This will update the project tree data structures
and send notifications about the rename.</p>
</div>
    
<dl>
    <dt>oldName</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>Old item name</dd>
    <dt>newName</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>New item name</dd>
    <dt>isFolder</dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>True if item is a folder; False if it is a file.</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>A promise object that will be resolved or rejected when the rename is finished.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function renameItem(oldName, newName, isFolder) {
        var result = new $.Deferred();
        
        if (oldName === newName) {
            result.resolve();
            return result.promise();
        }
        
        var entry = isFolder ? FileSystem.getDirectoryForPath(oldName) : FileSystem.getFileForPath(oldName);
        entry.rename(newName, function (err) {
            if (!err) {
                if (EditorManager.getCurrentlyViewedPath()) {
                    FileViewController.openAndSelectDocument(
                        EditorManager.getCurrentlyViewedPath(),
                        FileViewController.getFileSelectionFocus()
                    );
                }
                
                _redraw(true);
                result.resolve();
            } else {
                &#x2F;&#x2F; Show an error alert
                Dialogs.showModalDialog(
                    DefaultDialogs.DIALOG_ID_ERROR,
                    Strings.ERROR_RENAMING_FILE_TITLE,
                    StringUtils.format(
                        Strings.ERROR_RENAMING_FILE,
                        StringUtils.breakableUrl(newName),
                        err === FileSystemError.ALREADY_EXISTS ?
                                Strings.FILE_EXISTS_ERR :
                                FileUtils.getFileErrorString(err)
                    )
                );
                result.reject(err);
            }
        });
        
        return result.promise();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>renameItemInline</h4>

    
    <div class="description"><p>Initiates a rename of the selected item in the project tree, showing an inline editor
for input. Silently no-ops if the entry lies outside the tree or doesn&#39;t exist.</p>
</div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">(File, Directory)</dd>
    <dd>File or Directory to rename</dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function renameItemInline(entry) {
        &#x2F;&#x2F; First make sure the item in the tree is visible - jsTree&#39;s rename API doesn&#39;t do anything to ensure inline input is visible
        showInTree(entry)
            .done(function ($selected) {
                &#x2F;&#x2F; Don&#39;t try to rename again if we are already renaming
                if (_isInRename($selected)) {
                    return;
                }
                
                var isFolder = $selected.hasClass(&quot;jstree-open&quot;) || $selected.hasClass(&quot;jstree-closed&quot;);
        
                _projectTree.one(&quot;rename.jstree&quot;, function (event, data) {
                    var unescapedOldName = _.unescape(data.rslt.old_name),
                        unescapedNewName = _.unescape(data.rslt.new_name),
                        &#x2F;&#x2F; Make sure the file was actually renamed
                        changed = (unescapedOldName !== unescapedNewName);
                    
                    var _resetOldFilename = function () {
                        _projectTree.jstree(&quot;set_text&quot;, $selected, ViewUtils.getFileEntryDisplay(entry));
                    };
                    
                    if (!changed || !_checkForValidFilename(unescapedNewName, isFolder)) {
                        &#x2F;&#x2F; No change or invalid filename. Reset the old name and bail.
                        _resetOldFilename();
                        return;
                    }
                    
                    var oldFullPath = $selected.data(&quot;entry&quot;).fullPath;
                    &#x2F;&#x2F; Folder paths have to end with a slash. Use look-head (?=...) to only replace the folder&#39;s name, not the slash as well
                    
                    var oldNameEndPattern = isFolder ? &quot;(?=\&#x2F;$)&quot; : &quot;$&quot;;
                    var oldNameRegex = new RegExp(StringUtils.regexEscape(unescapedOldName) + oldNameEndPattern);
                    var newName = oldFullPath.replace(oldNameRegex, unescapedNewName);
                    
                    renameItem(oldFullPath, newName, isFolder)
                        .done(function () {
                            _projectTree.jstree(&quot;set_text&quot;, $selected, ViewUtils.getFileEntryDisplay(entry));
                            
                            &#x2F;&#x2F; Update caches: compareString and fullPathToIdMap
                            $selected.data(&quot;compareString&quot;, _toCompareString(entry.name, isFolder));
                            _deleteTreeNodeCache(oldFullPath);
                            _insertTreeNodeCache(entry, $selected.attr(&quot;id&quot;));
                            
                            &#x2F;&#x2F; If a folder was renamed, re-select it here, since openAndSelectDocument()
                            &#x2F;&#x2F; changed the selection.
                            if (isFolder) {
                                var oldSuppressToggleOpen = suppressToggleOpen;
                                
                                &#x2F;&#x2F; Supress the open&#x2F;close toggle
                                suppressToggleOpen = true;
                                _projectTree.jstree(&quot;select_node&quot;, $selected, true);
                                suppressToggleOpen = oldSuppressToggleOpen;
                            }
                        })
                        .fail(function (err) {
                            &#x2F;&#x2F; Error during rename. Reset to the old name and alert the user.
                            _resetOldFilename();
                        })
                        .always(function () {
                            _projectTree.jstree(&quot;sort&quot;, $selected.parent());
                            _redraw(true);
                        });
                });
                
                &#x2F;&#x2F; Since html_titles are enabled, we have to reset the text without markup.
                &#x2F;&#x2F; And we also need to explicitly escape all html-sensitive characters.
                var escapedName = _.escape(entry.name);
                _projectTree.jstree(&quot;set_text&quot;, $selected, escapedName);
                _projectTree.jstree(&quot;rename&quot;);

                var extension = FileUtils.getSmartFileExtension(entry.name);
                if (extension) {
                    var indexOfExtension = escapedName.length - extension.length - 1;
                    if (indexOfExtension &gt; 0) {
                        $selected.children(&quot;.jstree-rename-input&quot;)[0].setSelectionRange(0, indexOfExtension);
                    }
                }
            });
        &#x2F;&#x2F; No fail handler: silently no-op if file doesn&#39;t exist in tree
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>setBaseUrl</h4>

    
    <div class="description"><p>Sets the encoded Base URL of the currently loaded project.</p>
</div>
    
<dl>
    <dt></dt>
    <dd class="label label-info pull-left">String</dd>
    <dd></dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function setBaseUrl(projectBaseUrl) {
        var context = { location : { scope: &quot;user&quot;,
                                     layer: &quot;project&quot;,
                                     layerID: _projectRoot.fullPath} };
        
        _projectBaseUrl = projectBaseUrl;

        &#x2F;&#x2F; Ensure trailing slash to be consistent with _projectRoot.fullPath
        &#x2F;&#x2F; so they&#39;re interchangable (i.e. easy to convert back and forth)
        if (_projectBaseUrl.length &gt; 0 &amp;&amp; _projectBaseUrl[_projectBaseUrl.length - 1] !== &quot;&#x2F;&quot;) {
            _projectBaseUrl += &quot;&#x2F;&quot;;
        }

        PreferencesManager.setViewState(&quot;project.baseUrl&quot;, _projectBaseUrl, context);
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>shouldShow</h4>

    
    <div class="description"><p>Returns false for files and directories that are not commonly useful to display.</p>
</div>
    
<dl>
    <dt>entry</dt>
    <dd class="label label-info pull-left">FileSystemEntry</dd>
    <dd>File or directory to filter</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>true if the file should be displayed</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function shouldShow(entry) {
        return _shouldShowName(entry.name);
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>showInTree</h4>

    
    <div class="description"><p>Expands tree nodes to show the given file or folder and selects it. Silently no-ops if the
path lies outside the project, or if it doesn&#39;t exist.</p>
</div>
    
<dl>
    <dt>entry</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">(File, Directory)</dd>
    <dd>File or Directory to show</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>Resolved when done; or rejected if not found</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function showInTree(entry) {
        return _findTreeNode(entry)
            .done(function ($node) {
                &#x2F;&#x2F; jsTree will automatically expand parent nodes to ensure visible
                _projectTree.jstree(&quot;select_node&quot;, $node, false);
            });
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>updateWelcomeProjectPath</h4>

    
    <div class="description"><p>If the provided path is to an old welcome project, returns the current one instead.</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function updateWelcomeProjectPath(path) {
        if (isWelcomeProjectPath(path)) {
            return _getWelcomeProjectPath();
        } else {
            return path;
        }
    }</code></pre></div>
</section>

        </div>
      </div>
    </div>

    <script type="text/javascript" src="../../assets/js/prism.js"></script>
  </body>
</html>