<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CSSUtils - Brackets API</title>
    <link rel="stylesheet" href="../../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../../assets/css/typeahead.js-bootstrap.css">
    <link rel="stylesheet" href="../../assets/css/font-awesome.css">
    <link rel="stylesheet" href="../../assets/css/prism.css">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.css">
    <![endif]-->
    <script type="text/javascript" src="../../assets/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../../assets/js/bootstrap.js"></script>
    <script type="text/javascript" src="../../assets/js/typeahead.js"></script>
    <script type="text/javascript" src="../../assets/js/main.js"></script>
    <script src="http://use.edgefonts.net/source-sans-pro:n3,i3,n4,i4;source-code-pro.js"></script>

    <!-- Control the Flash of Unstyled Text (or FOUT) -->
    <style type="text/css">
        .wf-loading h1, .wf-loading h2, .wf-loading h3, .wf-loading h4,
        .wf-loading h5, .wf-loading h6, .wf-loading p, .wf-loading a {
            visibility: hidden;
        }
    </style>
    
    <script>
      window.moduleLevel = "../..";
    </script>
  </head>
  
  <body>
    <div class="row-fluid">
      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <a class="brand" href="../../index.html">Brackets API</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li><a href="#dependencies">Dependencies</a></li>
                <li><a href="#variables">Variables</a></li>
                <li><a href="#functions">Functions</a></li>
                <li><a href="#classes">Classes</a></li>
              </ul>
            </div>
            <input class="typeahead" placeholder="Search..." type="text" >
          </div>
        </div>
      </div>    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="left-section">
            <h2 class="number-of-modules">Modules (145)</h2>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_"><i class="icon-folder-open"></i>[root]</a>
              </li>
            </ul>
            <ul id="package_" class="nav nav-list">
              <li><a href="../../modules/brackets.html">brackets</a></li>
              <li><a href="../../modules/dependencies.html">dependencies</a></li>
              <li><a href="../../modules/main.html">main</a></li>
              <li><a href="../../modules/strings.html">strings</a></li>
              <li><a href="../../modules/xorigin.html">xorigin</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_command"><i class="icon-folder-open"></i>command</a>
              </li>
            </ul>
            <ul id="package_command" class="nav nav-list">
              <li><a href="../../modules/command/CommandManager.html">CommandManager</a></li>
              <li><a href="../../modules/command/Commands.html">Commands</a></li>
              <li><a href="../../modules/command/DefaultMenus.html">DefaultMenus</a></li>
              <li><a href="../../modules/command/KeyBindingManager.html">KeyBindingManager</a></li>
              <li><a href="../../modules/command/Menus.html">Menus</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_document"><i class="icon-folder-open"></i>document</a>
              </li>
            </ul>
            <ul id="package_document" class="nav nav-list">
              <li><a href="../../modules/document/ChangedDocumentTracker.html">ChangedDocumentTracker</a></li>
              <li><a href="../../modules/document/Document.html">Document</a></li>
              <li><a href="../../modules/document/DocumentCommandHandlers.html">DocumentCommandHandlers</a></li>
              <li><a href="../../modules/document/DocumentManager.html">DocumentManager</a></li>
              <li><a href="../../modules/document/InMemoryFile.html">InMemoryFile</a></li>
              <li><a href="../../modules/document/TextRange.html">TextRange</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_editor"><i class="icon-folder-open"></i>editor</a>
              </li>
            </ul>
            <ul id="package_editor" class="nav nav-list">
              <li><a href="../../modules/editor/CodeHintList.html">CodeHintList</a></li>
              <li><a href="../../modules/editor/CodeHintManager.html">CodeHintManager</a></li>
              <li><a href="../../modules/editor/CSSInlineEditor.html">CSSInlineEditor</a></li>
              <li><a href="../../modules/editor/Editor.html">Editor</a></li>
              <li><a href="../../modules/editor/EditorCommandHandlers.html">EditorCommandHandlers</a></li>
              <li><a href="../../modules/editor/EditorManager.html">EditorManager</a></li>
              <li><a href="../../modules/editor/EditorOptionHandlers.html">EditorOptionHandlers</a></li>
              <li><a href="../../modules/editor/EditorStatusBar.html">EditorStatusBar</a></li>
              <li><a href="../../modules/editor/ImageViewer.html">ImageViewer</a></li>
              <li><a href="../../modules/editor/InlineTextEditor.html">InlineTextEditor</a></li>
              <li><a href="../../modules/editor/InlineWidget.html">InlineWidget</a></li>
              <li><a href="../../modules/editor/MultiRangeInlineEditor.html">MultiRangeInlineEditor</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_extensibility"><i class="icon-folder-open"></i>extensibility</a>
              </li>
            </ul>
            <ul id="package_extensibility" class="nav nav-list">
              <li><a href="../../modules/extensibility/ExtensionManager.html">ExtensionManager</a></li>
              <li><a href="../../modules/extensibility/ExtensionManagerDialog.html">ExtensionManagerDialog</a></li>
              <li><a href="../../modules/extensibility/ExtensionManagerView.html">ExtensionManagerView</a></li>
              <li><a href="../../modules/extensibility/ExtensionManagerViewModel.html">ExtensionManagerViewModel</a></li>
              <li><a href="../../modules/extensibility/InstallExtensionDialog.html">InstallExtensionDialog</a></li>
              <li><a href="../../modules/extensibility/Package.html">Package</a></li>
              <li><a href="../../modules/extensibility/registry_utils.html">registry_utils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_file"><i class="icon-folder-open"></i>file</a>
              </li>
            </ul>
            <ul id="package_file" class="nav nav-list">
              <li><a href="../../modules/file/FileUtils.html">FileUtils</a></li>
              <li><a href="../../modules/file/NativeFileError.html">NativeFileError</a></li>
              <li><a href="../../modules/file/NativeFileSystem.html">NativeFileSystem</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_filesystem"><i class="icon-folder-open"></i>filesystem</a>
              </li>
            </ul>
            <ul id="package_filesystem" class="nav nav-list">
              <li><a href="../../modules/filesystem/Directory.html">Directory</a></li>
              <li><a href="../../modules/filesystem/File.html">File</a></li>
              <li><a href="../../modules/filesystem/FileIndex.html">FileIndex</a></li>
              <li><a href="../../modules/filesystem/FileSystem.html">FileSystem</a></li>
              <li><a href="../../modules/filesystem/FileSystemEntry.html">FileSystemEntry</a></li>
              <li><a href="../../modules/filesystem/FileSystemError.html">FileSystemError</a></li>
              <li><a href="../../modules/filesystem/FileSystemStats.html">FileSystemStats</a></li>
              <li><a href="../../modules/filesystem/WatchedRoot.html">WatchedRoot</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_filesystem_impls_appshell"><i class="icon-folder-open"></i>filesystem&#x2F;impls&#x2F;appshell</a>
              </li>
            </ul>
            <ul id="package_filesystem_impls_appshell" class="nav nav-list">
              <li><a href="../../modules/filesystem/impls/appshell/AppshellFileSystem.html">AppshellFileSystem</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_filesystem_impls_appshell_node"><i class="icon-folder-open"></i>filesystem&#x2F;impls&#x2F;appshell&#x2F;node</a>
              </li>
            </ul>
            <ul id="package_filesystem_impls_appshell_node" class="nav nav-list">
              <li><a href="../../modules/filesystem/impls/appshell/node/FileWatcherDomain.html">FileWatcherDomain</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_help"><i class="icon-folder-open"></i>help</a>
              </li>
            </ul>
            <ul id="package_help" class="nav nav-list">
              <li><a href="../../modules/help/HelpCommandHandlers.html">HelpCommandHandlers</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_language"><i class="icon-folder-open"></i>language</a>
              </li>
            </ul>
            <ul id="package_language" class="nav nav-list">
              <li><a href="../../modules/language/CodeInspection.html">CodeInspection</a></li>
              <li><a href="../../modules/language/CSSUtils.html">CSSUtils</a></li>
              <li><a href="../../modules/language/HTMLDOMDiff.html">HTMLDOMDiff</a></li>
              <li><a href="../../modules/language/HTMLInstrumentation.html">HTMLInstrumentation</a></li>
              <li><a href="../../modules/language/HTMLSimpleDOM.html">HTMLSimpleDOM</a></li>
              <li><a href="../../modules/language/HTMLTokenizer.html">HTMLTokenizer</a></li>
              <li><a href="../../modules/language/HTMLUtils.html">HTMLUtils</a></li>
              <li><a href="../../modules/language/JSUtils.html">JSUtils</a></li>
              <li><a href="../../modules/language/LanguageManager.html">LanguageManager</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Agents"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Agents</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Agents" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Agents/ConsoleAgent.html">ConsoleAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/CSSAgent.html">CSSAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/DOMAgent.html">DOMAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/DOMHelpers.html">DOMHelpers</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/DOMNode.html">DOMNode</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/EditAgent.html">EditAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/GotoAgent.html">GotoAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/HighlightAgent.html">HighlightAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/NetworkAgent.html">NetworkAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/RemoteAgent.html">RemoteAgent</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/RemoteFunctions.html">RemoteFunctions</a></li>
              <li><a href="../../modules/LiveDevelopment/Agents/ScriptAgent.html">ScriptAgent</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Documents"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Documents</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Documents" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Documents/CSSDocument.html">CSSDocument</a></li>
              <li><a href="../../modules/LiveDevelopment/Documents/HTMLDocument.html">HTMLDocument</a></li>
              <li><a href="../../modules/LiveDevelopment/Documents/JSDocument.html">JSDocument</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Inspector"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Inspector</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Inspector" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Inspector/Inspector.html">Inspector</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment"><i class="icon-folder-open"></i>LiveDevelopment</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/LiveDevelopment.html">LiveDevelopment</a></li>
              <li><a href="../../modules/LiveDevelopment/LiveDevServerManager.html">LiveDevServerManager</a></li>
              <li><a href="../../modules/LiveDevelopment/main.html">main</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_LiveDevelopment_Servers"><i class="icon-folder-open"></i>LiveDevelopment&#x2F;Servers</a>
              </li>
            </ul>
            <ul id="package_LiveDevelopment_Servers" class="nav nav-list">
              <li><a href="../../modules/LiveDevelopment/Servers/BaseServer.html">BaseServer</a></li>
              <li><a href="../../modules/LiveDevelopment/Servers/FileServer.html">FileServer</a></li>
              <li><a href="../../modules/LiveDevelopment/Servers/UserServer.html">UserServer</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_preferences"><i class="icon-folder-open"></i>preferences</a>
              </li>
            </ul>
            <ul id="package_preferences" class="nav nav-list">
              <li><a href="../../modules/preferences/PreferencesBase.html">PreferencesBase</a></li>
              <li><a href="../../modules/preferences/PreferencesDialogs.html">PreferencesDialogs</a></li>
              <li><a href="../../modules/preferences/PreferencesImpl.html">PreferencesImpl</a></li>
              <li><a href="../../modules/preferences/PreferencesManager.html">PreferencesManager</a></li>
              <li><a href="../../modules/preferences/PreferenceStorage.html">PreferenceStorage</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_project"><i class="icon-folder-open"></i>project</a>
              </li>
            </ul>
            <ul id="package_project" class="nav nav-list">
              <li><a href="../../modules/project/FileIndexManager.html">FileIndexManager</a></li>
              <li><a href="../../modules/project/FileSyncManager.html">FileSyncManager</a></li>
              <li><a href="../../modules/project/FileViewController.html">FileViewController</a></li>
              <li><a href="../../modules/project/ProjectManager.html">ProjectManager</a></li>
              <li><a href="../../modules/project/SidebarView.html">SidebarView</a></li>
              <li><a href="../../modules/project/WorkingSetSort.html">WorkingSetSort</a></li>
              <li><a href="../../modules/project/WorkingSetView.html">WorkingSetView</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_search"><i class="icon-folder-open"></i>search</a>
              </li>
            </ul>
            <ul id="package_search" class="nav nav-list">
              <li><a href="../../modules/search/FileFilters.html">FileFilters</a></li>
              <li><a href="../../modules/search/FindBar.html">FindBar</a></li>
              <li><a href="../../modules/search/FindInFiles.html">FindInFiles</a></li>
              <li><a href="../../modules/search/FindInFilesUI.html">FindInFilesUI</a></li>
              <li><a href="../../modules/search/FindReplace.html">FindReplace</a></li>
              <li><a href="../../modules/search/FindUtils.html">FindUtils</a></li>
              <li><a href="../../modules/search/QuickOpen.html">QuickOpen</a></li>
              <li><a href="../../modules/search/ScrollTrackMarkers.html">ScrollTrackMarkers</a></li>
              <li><a href="../../modules/search/SearchModel.html">SearchModel</a></li>
              <li><a href="../../modules/search/SearchResultsView.html">SearchResultsView</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_utils"><i class="icon-folder-open"></i>utils</a>
              </li>
            </ul>
            <ul id="package_utils" class="nav nav-list">
              <li><a href="../../modules/utils/AnimationUtils.html">AnimationUtils</a></li>
              <li><a href="../../modules/utils/AppInit.html">AppInit</a></li>
              <li><a href="../../modules/utils/Async.html">Async</a></li>
              <li><a href="../../modules/utils/BuildInfoUtils.html">BuildInfoUtils</a></li>
              <li><a href="../../modules/utils/CollectionUtils.html">CollectionUtils</a></li>
              <li><a href="../../modules/utils/ColorUtils.html">ColorUtils</a></li>
              <li><a href="../../modules/utils/DeprecationWarning.html">DeprecationWarning</a></li>
              <li><a href="../../modules/utils/DragAndDrop.html">DragAndDrop</a></li>
              <li><a href="../../modules/utils/DropdownEventHandler.html">DropdownEventHandler</a></li>
              <li><a href="../../modules/utils/ExtensionLoader.html">ExtensionLoader</a></li>
              <li><a href="../../modules/utils/ExtensionUtils.html">ExtensionUtils</a></li>
              <li><a href="../../modules/utils/Global.html">Global</a></li>
              <li><a href="../../modules/utils/KeyEvent.html">KeyEvent</a></li>
              <li><a href="../../modules/utils/NativeApp.html">NativeApp</a></li>
              <li><a href="../../modules/utils/NodeConnection.html">NodeConnection</a></li>
              <li><a href="../../modules/utils/NodeDomain.html">NodeDomain</a></li>
              <li><a href="../../modules/utils/PerfUtils.html">PerfUtils</a></li>
              <li><a href="../../modules/utils/Resizer.html">Resizer</a></li>
              <li><a href="../../modules/utils/ShellAPI.html">ShellAPI</a></li>
              <li><a href="../../modules/utils/StringMatch.html">StringMatch</a></li>
              <li><a href="../../modules/utils/StringUtils.html">StringUtils</a></li>
              <li><a href="../../modules/utils/TokenUtils.html">TokenUtils</a></li>
              <li><a href="../../modules/utils/UpdateNotification.html">UpdateNotification</a></li>
              <li><a href="../../modules/utils/UrlParams.html">UrlParams</a></li>
              <li><a href="../../modules/utils/ValidationUtils.html">ValidationUtils</a></li>
              <li><a href="../../modules/utils/ViewUtils.html">ViewUtils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_view"><i class="icon-folder-open"></i>view</a>
              </li>
            </ul>
            <ul id="package_view" class="nav nav-list">
              <li><a href="../../modules/view/PanelManager.html">PanelManager</a></li>
              <li><a href="../../modules/view/ViewCommandHandlers.html">ViewCommandHandlers</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_widgets"><i class="icon-folder-open"></i>widgets</a>
              </li>
            </ul>
            <ul id="package_widgets" class="nav nav-list">
              <li><a href="../../modules/widgets/bootstrap-alerts.html">bootstrap-alerts</a></li>
              <li><a href="../../modules/widgets/bootstrap-button.html">bootstrap-button</a></li>
              <li><a href="../../modules/widgets/bootstrap-dropdown.html">bootstrap-dropdown</a></li>
              <li><a href="../../modules/widgets/bootstrap-modal.html">bootstrap-modal</a></li>
              <li><a href="../../modules/widgets/bootstrap-popover.html">bootstrap-popover</a></li>
              <li><a href="../../modules/widgets/bootstrap-scrollspy.html">bootstrap-scrollspy</a></li>
              <li><a href="../../modules/widgets/bootstrap-tab.html">bootstrap-tab</a></li>
              <li><a href="../../modules/widgets/bootstrap-tooltip.html">bootstrap-tooltip</a></li>
              <li><a href="../../modules/widgets/bootstrap-twipsy-mod.html">bootstrap-twipsy-mod</a></li>
              <li><a href="../../modules/widgets/DefaultDialogs.html">DefaultDialogs</a></li>
              <li><a href="../../modules/widgets/Dialogs.html">Dialogs</a></li>
              <li><a href="../../modules/widgets/DropdownButton.html">DropdownButton</a></li>
              <li><a href="../../modules/widgets/ModalBar.html">ModalBar</a></li>
              <li><a href="../../modules/widgets/PopUpManager.html">PopUpManager</a></li>
              <li><a href="../../modules/widgets/StatusBar.html">StatusBar</a></li>
            </ul>
          </div>
        </div>
        <div class="module span9">
<h1>CSSUtils</h1>


<section class="description">
    <h3>Description</h3>
    
    <div><p>Set of utilities for simple parsing of CSS text.</p>
</div>
</section>

<section id="dependencies">
    <h3>Dependencies</h3>

    <ul class="nav nav-list">
        <li><a href="..&#x2F;../modules/utils/Async.html">Async</a></li>
        <li><a href="..&#x2F;../modules/thirdparty/CodeMirror2/lib/codemirror.html">codemirror</a></li>
        <li><a href="..&#x2F;../modules/document/DocumentManager.html">DocumentManager</a></li>
        <li><a href="..&#x2F;../modules/editor/EditorManager.html">EditorManager</a></li>
        <li><a href="..&#x2F;../modules/language/HTMLUtils.html">HTMLUtils</a></li>
        <li><a href="..&#x2F;../modules/thirdparty/lodash.html">lodash</a></li>
        <li><a href="..&#x2F;../modules/project/ProjectManager.html">ProjectManager</a></li>
        <li><a href="..&#x2F;../modules/utils/TokenUtils.html">TokenUtils</a></li>
    </ul>

</section>

<section id="functions">

    <h3>Functions 
<label class="checkbox">
    <input class="toggle-public" type="checkbox"> Show Private Members
</label>    </h3>

<div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_addSelectorsToResults</h4>

    
    <div class="description"><p>Converts the results of _findAllMatchingSelectorsInText() into a simpler bag of data and
appends those new objects to the given &#39;resultSelectors&#39; Array.</p>
</div>
    
<dl>
    <dt>resultSelectors</dt>
    <dd class="label label-info pull-left">Array.&lt;{document:Document,lineStart:number,lineEnd:number}&gt;</dd>
    <dd></dd>
    <dt>selectorsToAdd</dt>
    <dd class="label label-info pull-left">Array.&lt;{selectorGroupStartLine:number,declListEndLine:number,selector:string}&gt;</dd>
    <dd></dd>
    <dt>sourceDoc</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">Document</dd>
    <dd></dd>
    <dt>lineOffset</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">number</dd>
    <dd>Amount to offset all line number info by. Used if the first line of the parsed CSS text is not the first line of the sourceDoc.</dd>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _addSelectorsToResults(resultSelectors, selectorsToAdd, sourceDoc, lineOffset) {
        selectorsToAdd.forEach(function (selectorInfo) {
            resultSelectors.push({
                name: selectorInfo.selector,
                document: sourceDoc,
                lineStart: selectorInfo.ruleStartLine + lineOffset,
                lineEnd: selectorInfo.declListEndLine + lineOffset,
                selectorGroup: selectorInfo.selectorGroup
            });
        });
    }</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>_findAllMatchingSelectorsInText</h4>

    
    <div class="description"><p>Finds all instances of the specified selector in &quot;text&quot;.
Returns an Array of Objects with start and end properties.</p>
<p>For Sprint 4, we only support simple selectors. This function will need to change
dramatically to support full selectors.</p>
<p>FUTURE: (JRB) It would be nice to eventually use the browser/jquery to do the selector evaluation.
One way to do this would be to take the user&#39;s HTML, add a special attribute to every tag with a UID,
and then construct a DOM (using the commented out code above). Then, give this DOM and the selector to 
jquery and ask what matches. If the node that the user&#39;s cursor is in comes back from jquery, then 
we know the selector applies.</p>
</div>
    
<dl>
    <dt>{!string}</dt>
    <dd class="label label-info pull-left">text</dd>
    <dd>CSS text to search</dd>
    <dt>{!string}</dt>
    <dd class="label label-info pull-left">selector</dd>
    <dd>selector to search for</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">Array.&lt;{selectorGroupStartLine:number,declListEndLine:number,selector:string}&gt;</dd>
    <dd>Array of objects containing the start and end line numbers (0-based, inclusive range) for each matched selector.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _findAllMatchingSelectorsInText(text, selector) {
        var allSelectors = extractAllSelectors(text);
        var result = [];
        var i;
        
        &#x2F;&#x2F; For sprint 4 we only match the rightmost simple selector, and ignore 
        &#x2F;&#x2F; attribute selectors and pseudo selectors
        var classOrIdSelector = selector[0] === &quot;.&quot; || selector[0] === &quot;#&quot;;
        var prefix = &quot;&quot;;
        
        &#x2F;&#x2F; Escape initial &quot;.&quot; in selector, if present.
        if (selector[0] === &quot;.&quot;) {
            selector = &quot;\\&quot; + selector;
        }
        
        if (!classOrIdSelector) {
            &#x2F;&#x2F; Tag selectors must have nothing, whitespace, or a combinator before it.
            selector = &quot;(^|[\\s&gt;+~])&quot; + selector;
        }
        
        var re = new RegExp(selector + &quot;(\\[[^\\]]*\\]|:{1,2}[\\w-()]+|\\.[\\w-]+|#[\\w-]+)*\\s*$&quot;, classOrIdSelector ? &quot;&quot; : &quot;i&quot;);
        allSelectors.forEach(function (entry) {
            if (entry.selector.search(re) !== -1) {
                result.push(entry);
            } else if (!classOrIdSelector) {
                &#x2F;&#x2F; Special case for tag selectors - match &quot;*&quot; as the rightmost character
                if (&#x2F;\*\s*$&#x2F;.test(entry.selector)) {
                    result.push(entry);
                }
            }
        });
        
        return result;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_findMatchingRulesInCSSFiles</h4>

    
    <div class="description"><p>Finds matching selectors in CSS files; adds them to &#39;resultSelectors&#39;</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _findMatchingRulesInCSSFiles(selector, resultSelectors) {
        var result          = new $.Deferred();
        
        &#x2F;&#x2F; Load one CSS file and search its contents
        function _loadFileAndScan(fullPath, selector) {
            var oneFileResult = new $.Deferred();
            
            DocumentManager.getDocumentForPath(fullPath)
                .done(function (doc) {
                    &#x2F;&#x2F; Find all matching rules for the given CSS file&#39;s content, and add them to the
                    &#x2F;&#x2F; overall search result
                    var oneCSSFileMatches = _findAllMatchingSelectorsInText(doc.getText(), selector);
                    _addSelectorsToResults(resultSelectors, oneCSSFileMatches, doc, 0);
                    
                    oneFileResult.resolve();
                })
                .fail(function (error) {
                    oneFileResult.reject(error);
                });
        
            return oneFileResult.promise();
        }
        
        ProjectManager.getAllFiles(ProjectManager.getLanguageFilter(&quot;css&quot;))
            .done(function (cssFiles) {
                &#x2F;&#x2F; Load index of all CSS files; then process each CSS file in turn (see above)
                Async.doInParallel(cssFiles, function (fileInfo, number) {
                    return _loadFileAndScan(fileInfo.fullPath, selector);
                })
                    .then(result.resolve, result.reject);
            });
        
        return result.promise();
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_findMatchingRulesInStyleBlocks</h4>

    
    <div class="description"><p>Finds matching selectors in the &lt;style&gt; block of a single HTML file; adds them to &#39;resultSelectors&#39;</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _findMatchingRulesInStyleBlocks(htmlDocument, selector, resultSelectors) {
        &#x2F;&#x2F; HTMLUtils requires a real CodeMirror instance; make sure we can give it the right Editor
        var htmlEditor = EditorManager.getCurrentFullEditor();
        if (htmlEditor.document !== htmlDocument) {
            console.error(&quot;Cannot search for &lt;style&gt; blocks in HTML file other than current editor&quot;);
            return;
        }
        
        &#x2F;&#x2F; Find all &lt;style&gt; blocks in the HTML file
        var styleBlocks = HTMLUtils.findStyleBlocks(htmlEditor);
        
        styleBlocks.forEach(function (styleBlockInfo) {
            &#x2F;&#x2F; Search this one &lt;style&gt; block&#39;s content, appending results to &#39;resultSelectors&#39;
            var oneStyleBlockMatches = _findAllMatchingSelectorsInText(styleBlockInfo.text, selector);
            _addSelectorsToResults(resultSelectors, oneStyleBlockMatches, htmlDocument, styleBlockInfo.start.line);
        });
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getImportUrlInfo</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
    <dt>editor</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">Editor</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">{context: string,offset: number,name: string,index: number,values: Array.&lt;string&gt;,isNewItem: boolean,range: {start: {line: number,ch: number},end: {line: number,ch: number}}}</dd>
    <dd>A CSS context info object.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getImportUrlInfo(ctx, editor) {
        var propNamePos = $.extend({}, ctx.pos),
            backwardPos = $.extend({}, ctx.pos),
            forwardPos  = $.extend({}, ctx.pos),
            backwardCtx,
            forwardCtx,
            index = 0,
            propValues = [],
            offset = TokenUtils.offsetInToken(ctx),
            testPos = {ch: ctx.pos.ch + 1, line: ctx.pos.line},
            testToken = editor._codeMirror.getTokenAt(testPos, true);

        &#x2F;&#x2F; Currently only support url. May be null if starting to type
        if (ctx.token.type &amp;&amp; ctx.token.type !== &quot;string&quot;) {
            return createInfo();
        }

        &#x2F;&#x2F; Move backward to @import and collect data as we go. We return propValues
        &#x2F;&#x2F; array, but we can only have 1 value, so put all data in first item
        backwardCtx = TokenUtils.getInitialContext(editor._codeMirror, backwardPos);
        propValues[0] = backwardCtx.token.string;

        while (TokenUtils.movePrevToken(backwardCtx)) {
            if (backwardCtx.token.type === &quot;def&quot; &amp;&amp; backwardCtx.token.string === &quot;@import&quot;) {
                break;
            }
            
            if (backwardCtx.token.type &amp;&amp; backwardCtx.token.type !== &quot;tag&quot; &amp;&amp; backwardCtx.token.string !== &quot;url&quot;) {
                &#x2F;&#x2F; Previous token may be white-space
                &#x2F;&#x2F; Otherwise, previous token may only be &quot;url(&quot;
                break;
            }
            
            propValues[0] = backwardCtx.token.string + propValues[0];
            offset += backwardCtx.token.string.length;
        }
        
        if (backwardCtx.token.type !== &quot;def&quot; || backwardCtx.token.string !== &quot;@import&quot;) {
            &#x2F;&#x2F; Not in url
            return createInfo();
        }

        &#x2F;&#x2F; Get value after cursor up until closing paren or newline
        forwardCtx = TokenUtils.getInitialContext(editor._codeMirror, forwardPos);
        do {
            if (!TokenUtils.moveNextToken(forwardCtx)) {
                if (forwardCtx.token.string === &quot;(&quot;) {
                    break;
                } else {
                    return createInfo();
                }
            }
            propValues[0] += forwardCtx.token.string;
        } while (forwardCtx.token.string !== &quot;)&quot; &amp;&amp; forwardCtx.token.string !== &quot;&quot;);
        
        return createInfo(IMPORT_URL, offset, &quot;&quot;, index, propValues, false);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getPrecedingPropValues</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">?Array.&lt;string&gt;</dd>
    <dd>An array of all the space/comma seperated tokens before the current cursor position</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getPrecedingPropValues(ctx) {
        var lastValue = &quot;&quot;,
            curValue,
            propValues = [];
        while (ctx.token.string !== &quot;:&quot; &amp;&amp; TokenUtils.movePrevToken(ctx)) {
            if (ctx.token.string === &quot;:&quot; || !_isInPropValue(ctx)) {
                break;
            }

            curValue = ctx.token.string;
            if (lastValue !== &quot;&quot;) {
                curValue += lastValue;
            }

            if ((ctx.token.string.length &gt; 0 &amp;&amp; !ctx.token.string.match(&#x2F;\S&#x2F;)) ||
                    ctx.token.string === &quot;,&quot;) {
                lastValue = curValue;
            } else {
                lastValue = &quot;&quot;;
                if (propValues.length === 0 || curValue.match(&#x2F;,\s*$&#x2F;)) {
                    &#x2F;&#x2F; stack is empty, or current value ends with a comma
                    &#x2F;&#x2F; (and optional whitespace), so push it on the stack
                    propValues.push(curValue);
                } else {
                    &#x2F;&#x2F; current value does not end with a comma (and optional ws) so prepend
                    &#x2F;&#x2F; to last stack item (e.g. &quot;rgba(50&quot; get broken into 2 tokens)
                    propValues[propValues.length - 1] = curValue + propValues[propValues.length - 1];
                }
            }
        }
        if (propValues.length &gt; 0) {
            propValues.reverse();
        }
        
        return propValues;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getPropNameInfo</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>ctx</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd>context</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">{context: string,offset: number,name: string,index: number,values: Array.&lt;string&gt;,isNewItem: boolean,range: {start: {line: number,ch: number},end: {line: number,ch: number}}}</dd>
    <dd>A CSS context info object.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getPropNameInfo(ctx) {
        var propName = &quot;&quot;,
            offset = TokenUtils.offsetInToken(ctx),
            tokenString = ctx.token.string,
            excludedCharacters = [&quot;;&quot;, &quot;{&quot;, &quot;}&quot;];
        
        if (ctx.token.type === &quot;property&quot; || ctx.token.type === &quot;property error&quot; ||
                ctx.token.type === &quot;tag&quot;) {
            propName = tokenString;
            if (TokenUtils.movePrevToken(ctx) &amp;&amp; &#x2F;\S&#x2F;.test(ctx.token.string) &amp;&amp;
                    excludedCharacters.indexOf(ctx.token.string) === -1) {
                propName = ctx.token.string + tokenString;
                offset += ctx.token.string.length;
            }
        } else if (ctx.token.type === &quot;meta&quot; || tokenString === &quot;-&quot;) {
            propName = tokenString;
            if (TokenUtils.moveNextToken(ctx) &amp;&amp;
                    (ctx.token.type === &quot;property&quot; || ctx.token.type === &quot;property error&quot; ||
                    ctx.token.type === &quot;tag&quot;)) {
                propName += ctx.token.string;
            }
        } else if (&#x2F;\S&#x2F;.test(tokenString) &amp;&amp; excludedCharacters.indexOf(tokenString) === -1) {
            &#x2F;&#x2F; We&#39;re not inside the property name context.
            return createInfo();
        } else {
            var testPos = {ch: ctx.pos.ch + 1, line: ctx.pos.line},
                testToken = ctx.editor.getTokenAt(testPos, true);

            if (testToken.type === &quot;property&quot; || testToken.type === &quot;property error&quot; ||
                    testToken.type === &quot;tag&quot;) {
                propName = testToken.string;
                offset = 0;
            }
        }

        &#x2F;&#x2F; If we&#39;re in the property name context but not in an existing property name, 
        &#x2F;&#x2F; then reset offset to zero.
        if (propName === &quot;&quot;) {
            offset = 0;
        }

        return createInfo(PROP_NAME, offset, propName);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getPropNameStartingFromPropValue</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>the property name of the current rule.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getPropNameStartingFromPropValue(ctx) {
        var ctxClone = $.extend({}, ctx),
            propName = &quot;&quot;;
        do {
            &#x2F;&#x2F; If we&#39;re no longer in the property value before seeing a colon, then we don&#39;t
            &#x2F;&#x2F; have a valid property name. Just return an empty string.
            if (ctxClone.token.string !== &quot;:&quot; &amp;&amp; !_isInPropValue(ctxClone)) {
                return &quot;&quot;;
            }
        } while (ctxClone.token.string !== &quot;:&quot; &amp;&amp; TokenUtils.moveSkippingWhitespace(TokenUtils.movePrevToken, ctxClone));
        
        if (ctxClone.token.string === &quot;:&quot; &amp;&amp; TokenUtils.moveSkippingWhitespace(TokenUtils.movePrevToken, ctxClone) &amp;&amp;
                (ctxClone.token.type === &quot;property&quot; || ctxClone.token.type === &quot;property error&quot;)) {
            propName = ctxClone.token.string;
            if (TokenUtils.movePrevToken(ctxClone) &amp;&amp; ctxClone.token.type === &quot;meta&quot;) {
                propName = ctxClone.token.string + propName;
            }
        }
        
        return propName;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getRangeForPropValue</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>startCtx</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd>context</dd>
    <dt>endCtx</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd>context</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">{start: {line: number,ch: number},end: {line: number,ch: number}}</dd>
    <dd>A range object.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getRangeForPropValue(startCtx, endCtx) {
        var range = { &quot;start&quot;: {},
                      &quot;end&quot;: {} };
        
        &#x2F;&#x2F; Skip the &quot;:&quot; and any leading whitespace
        while (TokenUtils.moveNextToken(startCtx)) {
            if (&#x2F;\S&#x2F;.test(startCtx.token.string)) {
                break;
            }
        }
        
        &#x2F;&#x2F; Skip the trailing whitespace and property separators.
        while (endCtx.token.string === &quot;;&quot; || endCtx.token.string === &quot;}&quot; ||
                !&#x2F;\S&#x2F;.test(endCtx.token.string)) {
            TokenUtils.movePrevToken(endCtx);
        }
        
        range.start = _.clone(startCtx.pos);
        range.start.ch = startCtx.token.start;
        
        range.end = _.clone(endCtx.pos);
        range.end.ch = endCtx.token.end;
        
        return range;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getRuleInfoStartingFromPropValue</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
    <dt>editor</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">Editor</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">{context: string,offset: number,name: string,index: number,values: Array.&lt;string&gt;,isNewItem: boolean,range: {start: {line: number,ch: number},end: {line: number,ch: number}}}</dd>
    <dd>A CSS context info object.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getRuleInfoStartingFromPropValue(ctx, editor) {
        var propNamePos = $.extend({}, ctx.pos),
            backwardPos = $.extend({}, ctx.pos),
            forwardPos  = $.extend({}, ctx.pos),
            propNameCtx = TokenUtils.getInitialContext(editor._codeMirror, propNamePos),
            backwardCtx,
            forwardCtx,
            lastValue = &quot;&quot;,
            propValues = [],
            index = -1,
            offset = TokenUtils.offsetInToken(ctx),
            canAddNewOne = false,
            testPos = {ch: ctx.pos.ch + 1, line: ctx.pos.line},
            testToken = editor._codeMirror.getTokenAt(testPos, true),
            propName,
            range;
        
        &#x2F;&#x2F; Get property name first. If we don&#39;t have a valid property name, then 
        &#x2F;&#x2F; return a default rule info.
        propName = _getPropNameStartingFromPropValue(propNameCtx);
        if (!propName) {
            return createInfo();
        }
        
        &#x2F;&#x2F; Scan backward to collect all preceding property values
        backwardCtx = TokenUtils.getInitialContext(editor._codeMirror, backwardPos);
        propValues = _getPrecedingPropValues(backwardCtx);

        lastValue = &quot;&quot;;
        if (ctx.token.string === &quot;:&quot;) {
            index = 0;
            canAddNewOne = true;
        } else {
            index = propValues.length - 1;
            if (ctx.token.string === &quot;,&quot;) {
                propValues[index] += ctx.token.string;
                index++;
                canAddNewOne = true;
            } else {
                index = (index &lt; 0) ? 0 : index + 1;
                if (ctx.token.string.match(&#x2F;\S&#x2F;)) {
                    lastValue = ctx.token.string;
                } else {
                    &#x2F;&#x2F; Last token is all whitespace
                    canAddNewOne = true;
                    if (index &gt; 0) {
                        &#x2F;&#x2F; Append all spaces before the cursor to the previous value in values array
                        propValues[index - 1] += ctx.token.string.substr(0, offset);
                    }
                }
            }
        }
        
        if (canAddNewOne) {
            offset = 0;

            &#x2F;&#x2F; If pos is at EOL, then there&#39;s implied whitespace (newline).
            if (editor.document.getLine(ctx.pos.line).length &gt; ctx.pos.ch  &amp;&amp;
                    (testToken.string.length === 0 || testToken.string.match(&#x2F;\S&#x2F;))) {
                canAddNewOne = false;
            }
        }
        
        &#x2F;&#x2F; Scan forward to collect all succeeding property values and append to all propValues.
        forwardCtx = TokenUtils.getInitialContext(editor._codeMirror, forwardPos);
        propValues = propValues.concat(_getSucceedingPropValues(forwardCtx, lastValue));
        
        if (propValues.length) {
            range = _getRangeForPropValue(backwardCtx, forwardCtx);
        } else {
            &#x2F;&#x2F; No property value, so just return the cursor pos as range
            range = { &quot;start&quot;: _.clone(ctx.pos),
                      &quot;end&quot;: _.clone(ctx.pos) };
        }
        
        &#x2F;&#x2F; If current index is more than the propValues size, then the cursor is 
        &#x2F;&#x2F; at the end of the existing property values and is ready for adding another one.
        if (index === propValues.length) {
            canAddNewOne = true;
        }
        
        return createInfo(PROP_VALUE, offset, propName, index, propValues, canAddNewOne, range);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_getSucceedingPropValues</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
    <dt>currentValue</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>The token string at the current cursor position</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">?Array.&lt;string&gt;</dd>
    <dd>An array of all the space/comma seperated tokens after the current cursor position</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getSucceedingPropValues(ctx, currentValue) {
        var lastValue = currentValue,
            curValue,
            propValues = [];
        
        while (ctx.token.string !== &quot;;&quot; &amp;&amp; ctx.token.string !== &quot;}&quot; &amp;&amp; TokenUtils.moveNextToken(ctx)) {
            if (ctx.token.string === &quot;;&quot; || ctx.token.string === &quot;}&quot;) {
                break;
            }
            if (!_isInPropValue(ctx)) {
                lastValue = &quot;&quot;;
                break;
            }
            
            if (lastValue === &quot;&quot;) {
                lastValue = ctx.token.string.trim();
            } else if (lastValue.length &gt; 0) {
                if (ctx.token.string.length &gt; 0 &amp;&amp; !ctx.token.string.match(&#x2F;\S&#x2F;)) {
                    lastValue += ctx.token.string;
                    propValues.push(lastValue);
                    lastValue = &quot;&quot;;
                } else if (ctx.token.string === &quot;,&quot;) {
                    lastValue += ctx.token.string;
                } else if (lastValue &amp;&amp; lastValue.match(&#x2F;,$&#x2F;)) {
                    propValues.push(lastValue);
                    if (ctx.token.string.length &gt; 0) {
                        lastValue = ctx.token.string;
                    } else {
                        lastValue = &quot;&quot;;
                    }
                } else {
                    &#x2F;&#x2F; e.g. &quot;rgba(50&quot; gets broken into 2 tokens
                    lastValue += ctx.token.string;
                }
            }
        }
        if (lastValue.length &gt; 0) {
            propValues.push(lastValue);
        }

        return propValues;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_isInAtRule</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>true if the context is in property value</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _isInAtRule(ctx) {
        var state;
        if (!ctx || !ctx.token || !ctx.token.state) {
            return false;
        }

        state = ctx.token.state.localState || ctx.token.state;
        
        if (!state.context) {
            return false;
        }
        return (state.context.type === &quot;at&quot;);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_isInPropName</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>true if the context is in property name</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _isInPropName(ctx) {
        var state,
            lastToken;
        if (!ctx || !ctx.token || !ctx.token.state || ctx.token.type === &quot;comment&quot;) {
            return false;
        }

        state = ctx.token.state.localState || ctx.token.state;
        
        if (!state.context) {
            return false;
        }
        
        lastToken = state.context.type;
        return (lastToken === &quot;{&quot; || lastToken === &quot;rule&quot; || lastToken === &quot;block&quot;);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_isInPropValue</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <dd class="label label-info pull-left">editor:{CodeMirror},pos:{ch:{string},line:{number}},token:{object}</dd>
    <dd></dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>true if the context is in property value</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _isInPropValue(ctx) {
        
        function isInsideParens(context) {
            if (context.type !== &quot;parens&quot; || !context.prev) {
                return false;
            }
                                                             
            if (context.prev.type === &quot;prop&quot;) {
                return true;
            }
            
            return isInsideParens(context.prev);
        }
        
        var state;
        if (!ctx || !ctx.token || !ctx.token.state || ctx.token.type === &quot;comment&quot;) {
            return false;
        }

        state = ctx.token.state.localState || ctx.token.state;
        
        if (!state.context || !state.context.prev) {
            return false;
        }
        return ((state.context.type === &quot;prop&quot; &amp;&amp;
                    (state.context.prev.type === &quot;rule&quot; || state.context.prev.type === &quot;block&quot;)) ||
                    isInsideParens(state.context));
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_removeComments</h4>

    
    <div class="description"><p>removes CSS comments from the content </p>
</div>
    
<dl>
    <dt>content</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>to reduce</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>reduced content</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _removeComments(content) {
        return content.replace(&#x2F;\&#x2F;\*(?:(?!\*\&#x2F;)[\s\S])*\*\&#x2F;&#x2F;g, &quot;&quot;);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>_removeStrings</h4>

    
    <div class="description"><p>removes strings from the content </p>
</div>
    
<dl>
    <dt>content</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>to reduce</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>reduced content</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _removeStrings(content) {
        return content.replace(&#x2F;[^\\]\&quot;(.*)[^\\]\&quot;|[^\\]\&#39;(.*)[^\\]\&#39;+&#x2F;g, &quot;&quot;);
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>addRuleToDocument</h4>

    
    <div class="description"><p>Adds a new rule to the end of the given document, and returns the range of the added rule
and the position of the cursor on the indented blank line within it. Note that the range will
not include all the inserted text (we insert extra newlines before and after the rule).</p>
</div>
    
<dl>
    <dt>doc</dt>
    <dd class="label label-info pull-left">Document</dd>
    <dd>The document to insert the rule into.</dd>
    <dt>selector</dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>The selector to use for the given rule.</dd>
    <dt>useTabChar</dt>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>Whether to indent with a tab.</dd>
    <dt>indentUnit</dt>
    <dd class="label label-info pull-left">number</dd>
    <dd>If useTabChar is false, how many spaces to indent with.</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">{range: {from: {line: number,ch: number},to: {line: number,ch: number}},pos: {line: number,ch: number}}</dd>
    <dd>The range of the inserted rule and the location where the cursor should be placed.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function addRuleToDocument(doc, selector, useTabChar, indentUnit) {
        var newRule = &quot;\n&quot; + selector + &quot; {\n&quot;,
            blankLineOffset;
        if (useTabChar) {
            newRule += &quot;\t&quot;;
            blankLineOffset = 1;
        } else {
            var i;
            for (i = 0; i &lt; indentUnit; i++) {
                newRule += &quot; &quot;;
            }
            blankLineOffset = indentUnit;
        }
        newRule += &quot;\n}\n&quot;;
        
        var docLines = doc.getText().split(&quot;\n&quot;),
            lastDocLine = docLines.length - 1,
            lastDocChar = docLines[docLines.length - 1].length;
        doc.replaceRange(newRule, {line: lastDocLine, ch: lastDocChar});
        return {
            range: {
                from: {line: lastDocLine + 1, ch: 0},
                to: {line: lastDocLine + 3, ch: 1}
            },
            pos: {line: lastDocLine + 2, ch: blankLineOffset}
        };
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>consolidateRules</h4>

    
    <div class="description"><p>In the given rule array (as returned by <code>findMatchingRules()</code>), if multiple rules in a row 
refer to the same rule (because there were multiple matching selectors), eliminate the redundant 
rules. Also, always use the selector group if available instead of the original matching selector.</p>
</div>
    
<dl>
</dl><dl>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function consolidateRules(rules) {
        var newRules = [], lastRule;
        rules.forEach(function (rule) {
            if (rule.selectorGroup) {
                rule.name = rule.selectorGroup;
            }
            &#x2F;&#x2F; Push the entry unless it refers to the same rule as the previous entry.
            if (!(lastRule &amp;&amp;
                     rule.document === lastRule.document &amp;&amp;
                     rule.lineStart === lastRule.lineStart &amp;&amp;
                     rule.lineEnd === lastRule.lineEnd &amp;&amp;
                     rule.selectorGroup === lastRule.selectorGroup)) {
                newRules.push(rule);
            }
            lastRule = rule;
        });
        return newRules;
    }</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>createInfo</h4>

    
    <div class="description"></div>
    
<dl>
    <dt>context</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>A constant string </dd>
    <dt>offset</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">number</dd>
    <dd>The offset of the token for a given cursor position</dd>
    <dt>name</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>Property name of the context </dd>
    <dt>index</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">number</dd>
    <dd>The index of the property value for a given cursor position</dd>
    <dt>values</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">Array.&lt;string&gt;</dd>
    <dd>An array of property values </dd>
    <dt>isNewItem</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">boolean</dd>
    <dd>If this is true, then the value in index refers to the index at which a new item is going to be inserted and should not be used for accessing an existing value in values array. </dd>
    <dt>range</dt>
    <span class="label label-optional pull-left">optional</span>
    <dd class="label label-info pull-left">{start: {line: number, ch: number}, end: {line: number, ch: number}}</dd>
    <dd>A range object with a start position and an end position</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">{context: string,offset: number,name: string,index: number,values: Array.&lt;string&gt;,isNewItem: boolean,range: {start: {line: number,ch: number},end: {line: number,ch: number}}}</dd>
    <dd>A CSS context info object.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function createInfo(context, offset, name, index, values, isNewItem, range) {
        var ruleInfo = { context: context || &quot;&quot;,
                         offset: offset || 0,
                         name: name || &quot;&quot;,
                         index: -1,
                         values: [],
                         isNewItem: (isNewItem === true),
                         range: range };
        
        if (context === PROP_VALUE || context === SELECTOR || context === IMPORT_URL) {
            ruleInfo.index = index;
            ruleInfo.values = values;
        }
        
        return ruleInfo;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>extractAllNamedFlows</h4>

    
    <div class="description"><p>Extracts all named flow instances</p>
</div>
    
<dl>
    <dt>text</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>to extract from</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">Array.&lt;string&gt;</dd>
    <dd>array of unique flow names found in the content (empty if none)</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function extractAllNamedFlows(text) {
        var namedFlowRegEx = &#x2F;(?:flow\-(into|from)\:\s*)([\w\-]+)(?:\s*;)&#x2F;gi,
            result = [],
            names = {},
            thisMatch;
        
        &#x2F;&#x2F; Reduce the content so that matches 
        &#x2F;&#x2F; inside strings and comments are ignored 
        text = reduceStyleSheetForRegExParsing(text);

        &#x2F;&#x2F; Find the first match
        thisMatch = namedFlowRegEx.exec(text);
        
        &#x2F;&#x2F; Iterate over the matches and add them to result
        while (thisMatch) {
            var thisName = thisMatch[2];
            
            if (IGNORED_FLOW_NAMES.indexOf(thisName) === -1 &amp;&amp; !names.hasOwnProperty(thisName)) {
                names[thisName] = result.push(thisName);
            }
            thisMatch = namedFlowRegEx.exec(text);
        }
        
        return result;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>extractAllSelectors</h4>

    
    <div class="description"><p>Extracts all CSS selectors from the given text
Returns an array of selectors. Each selector is an object with the following properties:
         selector:                 the text of the selector (note: comma separated selector groups like 
                                   &quot;h1, h2&quot; are broken into separate selectors)
         ruleStartLine:            line in the text where the rule (including preceding comment) appears
         ruleStartChar:            column in the line where the rule (including preceding comment) starts
         selectorStartLine:        line in the text where the selector appears
         selectorStartChar:        column in the line where the selector starts
         selectorEndLine:          line where the selector ends
         selectorEndChar:          column where the selector ends
         selectorGroupStartLine:   line where the comma-separated selector group (e.g. .foo, .bar, .baz)
                                   starts that this selector (e.g. .baz) is part of. Particularly relevant for
                                   groups that are on multiple lines.
         selectorGroupStartChar:   column in line where the selector group starts.
         selectorGroup:            the entire selector group containing this selector, or undefined if there 
                                   is only one selector in the rule.
         declListStartLine:        line where the declaration list for the rule starts
         declListStartChar:        column in line where the declaration list for the rule starts
         declListEndLine:          line where the declaration list for the rule ends
         declListEndChar:          column in the line where the declaration list for the rule ends</p>
</div>
    
<dl>
    <dt>{!string}</dt>
    <dd class="label label-info pull-left">text</dd>
    <dd>CSS text to extract from</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">Array.&lt;Object&gt;</dd>
    <dd>Array with objects specifying selectors.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function extractAllSelectors(text) {
        var selectors = [];
        var mode = CodeMirror.getMode({indentUnit: 2}, &quot;css&quot;);
        var state, lines, lineCount;
        var token, style, stream, line;
        var currentSelector = &quot;&quot;;
        var ruleStartChar = -1, ruleStartLine = -1;
        var selectorStartChar = -1, selectorStartLine = -1;
        var selectorGroupStartLine = -1, selectorGroupStartChar = -1;
        var declListStartLine = -1, declListStartChar = -1;
        var escapePattern = new RegExp(&quot;\\\\[^\\\\]+&quot;, &quot;g&quot;);
        var validationPattern = new RegExp(&quot;\\\\([a-f0-9]{6}|[a-f0-9]{4}(\\s|\\\\|$)|[a-f0-9]{2}(\\s|\\\\|$)|.)&quot;, &quot;i&quot;);
        
        &#x2F;&#x2F; implement _firstToken()&#x2F;_nextToken() methods to
        &#x2F;&#x2F; provide a single stream of tokens
        
        function _hasStream() {
            while (stream.eol()) {
                line++;
                if (line &gt;= lineCount) {
                    return false;
                }
                if (currentSelector.match(&#x2F;\S&#x2F;)) {
                    &#x2F;&#x2F; If we are in a current selector and starting a newline,
                    &#x2F;&#x2F; make sure there is whitespace in the selector
                    currentSelector += &quot; &quot;;
                }
                stream = new CodeMirror.StringStream(lines[line]);
            }
            return true;
        }
        
        function _firstToken() {
            state = CodeMirror.startState(mode);
            lines = CodeMirror.splitLines(text);
            lineCount = lines.length;
            if (lineCount === 0) {
                return false;
            }
            line = 0;
            stream = new CodeMirror.StringStream(lines[line]);
            if (!_hasStream()) {
                return false;
            }
            style = mode.token(stream, state);
            token = stream.current();
            return true;
        }
        
        function _nextToken() {
            &#x2F;&#x2F; advance the stream past this token
            stream.start = stream.pos;
            if (!_hasStream()) {
                return false;
            }
            style = mode.token(stream, state);
            token = stream.current();
            return true;
        }
        
        function _firstTokenSkippingWhitespace() {
            if (!_firstToken()) {
                return false;
            }
            while (!token.match(&#x2F;\S&#x2F;)) {
                if (!_nextToken()) {
                    return false;
                }
            }
            return true;
        }
        
        function _nextTokenSkippingWhitespace() {
            if (!_nextToken()) {
                return false;
            }
            while (!token.match(&#x2F;\S&#x2F;)) {
                if (!_nextToken()) {
                    return false;
                }
            }
            return true;
        }

        function _isStartComment() {
            return (token.match(&#x2F;^\&#x2F;\*&#x2F;));
        }
        
        function _parseComment() {
            while (!token.match(&#x2F;\*\&#x2F;$&#x2F;)) {
                if (!_nextToken()) {
                    break;
                }
            }
        }

        function _nextTokenSkippingComments() {
            if (!_nextToken()) {
                return false;
            }
            while (_isStartComment()) {
                _parseComment();
                if (!_nextToken()) {
                    return false;
                }
            }
            return true;
        }

        function _parseSelector(start) {
            
            currentSelector = &quot;&quot;;
            selectorStartChar = start;
            selectorStartLine = line;
            
            &#x2F;&#x2F; Everything until the next &#39;,&#39; or &#39;{&#39; is part of the current selector
            while (token !== &quot;,&quot; &amp;&amp; token !== &quot;{&quot;) {
                currentSelector += token;
                if (!_nextTokenSkippingComments()) {
                    return false; &#x2F;&#x2F; eof
                }
            }
            
            &#x2F;&#x2F; Unicode character replacement as defined in http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;CSS21&#x2F;syndata.html#characters
            if (&#x2F;\\&#x2F;.test(currentSelector)) {
                &#x2F;&#x2F; Double replace in case of pattern overlapping (regex improvement?)
                currentSelector = currentSelector.replace(escapePattern, function (escapedToken) {
                    return escapedToken.replace(validationPattern, function (unicodeChar) {
                        unicodeChar = unicodeChar.substr(1);
                        if (unicodeChar.length === 1) {
                            return unicodeChar;
                        } else {
                            if (parseInt(unicodeChar, 16) &lt; 0x10FFFF) {
                                return String.fromCharCode(parseInt(unicodeChar, 16));
                            } else { return String.fromCharCode(0xFFFD); }
                        }
                    });
                });
            }
            
            currentSelector = currentSelector.trim();
            var startChar = (selectorGroupStartLine === -1) ? selectorStartChar : selectorStartChar + 1;
            var selectorStart = (stream.string.indexOf(currentSelector, selectorStartChar) !== -1) ? stream.string.indexOf(currentSelector, selectorStartChar - currentSelector.length) : startChar;

            if (currentSelector !== &quot;&quot;) {
                selectors.push({selector: currentSelector,
                                ruleStartLine: ruleStartLine,
                                ruleStartChar: ruleStartChar,
                                selectorStartLine: selectorStartLine,
                                selectorStartChar: selectorStart,
                                declListEndLine: -1,
                                selectorEndLine: line,
                                selectorEndChar: selectorStart + currentSelector.length,
                                selectorGroupStartLine: selectorGroupStartLine,
                                selectorGroupStartChar: selectorGroupStartChar
                               });
                currentSelector = &quot;&quot;;
            }
            selectorStartChar = -1;

            return true;
        }
        
        function _parseSelectorList() {
            selectorGroupStartLine = (stream.string.indexOf(&quot;,&quot;) !== -1) ? line : -1;
            selectorGroupStartChar = stream.start;

            if (!_parseSelector(stream.start)) {
                return false;
            }

            while (token === &quot;,&quot;) {
                if (!_nextTokenSkippingComments()) {
                    return false; &#x2F;&#x2F; eof
                }
                if (!_parseSelector(stream.start)) {
                    return false;
                }
            }

            return true;
        }

        function _parseDeclarationList() {

            var j;
            declListStartLine = Math.min(line, lineCount - 1);
            declListStartChar = stream.start;
            
            &#x2F;&#x2F; Extract the entire selector group we just saw.
            var selectorGroup, sgLine;
            if (selectorGroupStartLine !== -1) {
                selectorGroup = &quot;&quot;;
                for (sgLine = selectorGroupStartLine; sgLine &lt;= declListStartLine; sgLine++) {
                    var startChar = 0, endChar = lines[sgLine].length;
                    if (sgLine === selectorGroupStartLine) {
                        startChar = selectorGroupStartChar;
                    } else {
                        selectorGroup += &quot; &quot;; &#x2F;&#x2F; replace the newline with a single space
                    }
                    if (sgLine === declListStartLine) {
                        endChar = declListStartChar;
                    }
                    selectorGroup += lines[sgLine].substring(startChar, endChar);
                }
                selectorGroup = selectorGroup.trim();
            }

            &#x2F;&#x2F; Since we&#39;re now in a declaration list, that means we also finished
            &#x2F;&#x2F; parsing the whole selector group. Therefore, reset selectorGroupStartLine
            &#x2F;&#x2F; so that next time we parse a selector we know it&#39;s a new group
            selectorGroupStartLine = -1;
            selectorGroupStartChar = -1;
            ruleStartLine = -1;
            ruleStartChar = -1;

            &#x2F;&#x2F; Skip everything until the next &#39;}&#39;
            while (token !== &quot;}&quot;) {
                if (!_nextTokenSkippingComments()) {
                    break;
                }
            }
            
            &#x2F;&#x2F; assign this declaration list position and selector group to every selector on the stack
            &#x2F;&#x2F; that doesn&#39;t have a declaration list start and end line
            for (j = selectors.length - 1; j &gt;= 0; j--) {
                if (selectors[j].declListEndLine !== -1) {
                    break;
                } else {
                    selectors[j].declListStartLine = declListStartLine;
                    selectors[j].declListStartChar = declListStartChar;
                    selectors[j].declListEndLine = line;
                    selectors[j].declListEndChar = stream.pos - 1; &#x2F;&#x2F; stream.pos actually points to the char after the }
                    if (selectorGroup) {
                        selectors[j].selectorGroup = selectorGroup;
                    }
                }
            }
        }
        
        function includeCommentInNextRule() {
            if (ruleStartChar !== -1) {
                return false;       &#x2F;&#x2F; already included
            }
            if (stream.start &gt; 0 &amp;&amp; lines[line].substr(0, stream.start).indexOf(&quot;}&quot;) !== -1) {
                return false;       &#x2F;&#x2F; on same line as &#39;}&#39;, so it&#39;s for previous rule
            }
            return true;
        }
        
        function _isStartAtRule() {
            return (token.match(&#x2F;^@&#x2F;));
        }
        
        function _parseAtRule() {

            &#x2F;&#x2F; reset these fields to ignore comments preceding @rules
            ruleStartLine = -1;
            ruleStartChar = -1;
            selectorStartLine = -1;
            selectorStartChar = -1;
            selectorGroupStartLine = -1;
            selectorGroupStartChar = -1;
            
            if (token.match(&#x2F;@media&#x2F;i)) {
                &#x2F;&#x2F; @media rule holds a rule list
                
                &#x2F;&#x2F; Skip everything until the opening &#39;{&#39;
                while (token !== &quot;{&quot;) {
                    if (!_nextTokenSkippingComments()) {
                        return; &#x2F;&#x2F; eof
                    }
                }

                &#x2F;&#x2F; skip past &#39;{&#39;, to next non-ws token
                if (!_nextTokenSkippingWhitespace()) {
                    return; &#x2F;&#x2F; eof
                }

                &#x2F;&#x2F; Parse rules until we see &#39;}&#39;
                _parseRuleList(&quot;}&quot;);

            } else if (token.match(&#x2F;@(charset|import|namespace)&#x2F;i)) {
                
                &#x2F;&#x2F; This code handles @rules in this format:
                &#x2F;&#x2F;   @rule ... ;
                &#x2F;&#x2F; Skip everything until the next &#39;;&#39;
                while (token !== &quot;;&quot;) {
                    if (!_nextTokenSkippingComments()) {
                        return; &#x2F;&#x2F; eof
                    }
                }
                
            } else {
                &#x2F;&#x2F; This code handle @rules that use this format:
                &#x2F;&#x2F;    @rule ... { ... }
                &#x2F;&#x2F; such as @page, @keyframes (also -webkit-keyframes, etc.), and @font-face.
                &#x2F;&#x2F; Skip everything until the next &#39;}&#39;
                while (token !== &quot;}&quot;) {
                    if (!_nextTokenSkippingComments()) {
                        return; &#x2F;&#x2F; eof
                    }
                }
            }
        }

        &#x2F;&#x2F; parse a style rule
        function _parseRule() {
            if (!_parseSelectorList()) {
                return false;
            }

            _parseDeclarationList();
        }
        
        function _parseRuleList(escapeToken) {
            
            while ((!escapeToken) || token !== escapeToken) {
                if (_isStartAtRule()) {
                    &#x2F;&#x2F; @rule
                    _parseAtRule();
    
                } else if (_isStartComment()) {
                    &#x2F;&#x2F; comment - make this part of style rule
                    if (includeCommentInNextRule()) {
                        ruleStartChar = stream.start;
                        ruleStartLine = line;
                    }
                    _parseComment();
    
                } else {
                    &#x2F;&#x2F; Otherwise, it&#39;s style rule
                    if (ruleStartChar === -1) {
                        ruleStartChar = stream.start;
                        ruleStartLine = line;
                    }
                    _parseRule();
                }
                
                if (!_nextTokenSkippingWhitespace()) {
                    break;
                }
            }
        }
        
        &#x2F;&#x2F; Do parsing

        if (_firstTokenSkippingWhitespace()) {

            &#x2F;&#x2F; Style sheet is a rule list
            _parseRuleList();
        }

        return selectors;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>findMatchingRules</h4>

    
    <div class="description"><p>Return all rules matching the specified selector.
For Sprint 4, we only look at the rightmost simple selector. For example, searching for &quot;.foo&quot; will 
match these rules:
 .foo {}
 div .foo {}
 div.foo {}
 div .foo[bar=&quot;42&quot;] {}
 div .foo:hovered {}
 div .foo::first-child
but will <em>not</em> match these rules:
 .foobar {}
 .foo .bar {}
 div .foo .bar {}
 .foo.bar {}</p>
</div>
    
<dl>
    <dt>selector</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>The selector to match. This can be a tag selector, class selector or id selector</dd>
    <dt>htmlDocument</dt>
    <span class="label label-nullable pull-left">nullable</span>
    <dd class="label label-info pull-left">Document</dd>
    <dd>An HTML file for context (so we can search <style> blocks)</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">$.Promise</dd>
    <dd>that will be resolved with an Array of objects containing the source document, start line, and end line (0-based, inclusive range) for each matching declaration list. Does not addRef() the documents returned in the array.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function findMatchingRules(selector, htmlDocument) {
        var result          = new $.Deferred(),
            resultSelectors = [];
        
        &#x2F;&#x2F; Synchronously search for matches in &lt;style&gt; blocks
        if (htmlDocument) {
            _findMatchingRulesInStyleBlocks(htmlDocument, selector, resultSelectors);
        }
        
        &#x2F;&#x2F; Asynchronously search for matches in all the project&#39;s CSS files
        &#x2F;&#x2F; (results are appended together in same &#39;resultSelectors&#39; array)
        _findMatchingRulesInCSSFiles(selector, resultSelectors)
            .done(function () {
                result.resolve(resultSelectors);
            })
            .fail(function (error) {
                result.reject(error);
            });
        
        return result.promise();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>findSelectorAtDocumentPos</h4>

    
    <div class="description"><p>Returns the selector(s) of the rule at the specified document pos, or &quot;&quot; if the position is 
is not within a style rule.</p>
</div>
    
<dl>
    <dt>editor</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">Editor</dd>
    <dd>Editor to search</dd>
    <dt>pos</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">{line: number, ch: number}</dd>
    <dd>Position to search</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>Selector(s) for the rule at the specified position, or "" if the position is not within a style rule. If the rule has multiple selectors, a comma-separated selector string is returned.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function findSelectorAtDocumentPos(editor, pos) {
        var cm = editor._codeMirror;
        var ctx = TokenUtils.getInitialContext(cm, $.extend({}, pos));
        var selector = &quot;&quot;, inSelector = false, foundChars = false;

        function _stripAtRules(selector) {
            selector = selector.trim();
            if (selector.indexOf(&quot;@&quot;) === 0) {
                return &quot;&quot;;
            }
            return selector;
        }
        
        &#x2F;&#x2F; Parse a selector. Assumes ctx is pointing at the opening
        &#x2F;&#x2F; { that is after the selector name.
        function _parseSelector(ctx) {
            var selector = &quot;&quot;;
            
            &#x2F;&#x2F; Skip over {
            TokenUtils.movePrevToken(ctx);
            
            while (true) {
                if (ctx.token.type !== &quot;comment&quot;) {
                    &#x2F;&#x2F; Stop once we&#39;ve reached a {, }, or ;
                    if (&#x2F;[\{\}\;]&#x2F;.test(ctx.token.string)) {
                        break;
                    }
                    
                    &#x2F;&#x2F; Stop once we&#39;ve reached a &lt;style ...&gt; tag
                    if (ctx.token.string === &quot;style&quot; &amp;&amp; ctx.token.type === &quot;tag&quot;) {
                        &#x2F;&#x2F; Remove everything up to end-of-tag from selector
                        var eotIndex = selector.indexOf(&quot;&gt;&quot;);
                        if (eotIndex !== -1) {
                            selector = selector.substring(eotIndex + 1);
                        }
                        break;
                    }
                    
                    selector = ctx.token.string + selector;
                }
                if (!TokenUtils.movePrevToken(ctx)) {
                    break;
                }
            }
            
            return selector;
        }
        
        &#x2F;&#x2F; scan backwards to see if the cursor is in a rule
        while (true) {
            if (ctx.token.type !== &quot;comment&quot;) {
                if (ctx.token.string === &quot;}&quot;) {
                    break;
                } else if (ctx.token.string === &quot;{&quot;) {
                    selector = _parseSelector(ctx);
                    break;
                } else {
                    if (&#x2F;\S&#x2F;.test(ctx.token.string)) {
                        foundChars = true;
                    }
                }
            }
            
            if (!TokenUtils.movePrevToken(ctx)) {
                break;
            }
        }
        
        selector = _stripAtRules(selector);
        
        &#x2F;&#x2F; Reset the context to original scan position
        ctx = TokenUtils.getInitialContext(cm, $.extend({}, pos));
        
        &#x2F;&#x2F; special case - we aren&#39;t in a selector and haven&#39;t found any chars,
        &#x2F;&#x2F; look at the next immediate token to see if it is non-whitespace
        if (!selector &amp;&amp; !foundChars) {
            if (TokenUtils.moveNextToken(ctx) &amp;&amp; ctx.token.type !== &quot;comment&quot; &amp;&amp; &#x2F;\S&#x2F;.test(ctx.token.string)) {
                foundChars = true;
                ctx = TokenUtils.getInitialContext(cm, $.extend({}, pos));
            }
        }
        
        &#x2F;&#x2F; At this point if we haven&#39;t found a selector, but have seen chars when
        &#x2F;&#x2F; scanning, assume we are in the middle of a selector.
        if (!selector &amp;&amp; foundChars) {
            &#x2F;&#x2F; scan forward to see if the cursor is in a selector
            while (true) {
                if (ctx.token.type !== &quot;comment&quot;) {
                    if (ctx.token.string === &quot;{&quot;) {
                        selector = _parseSelector(ctx);
                        break;
                    } else if (ctx.token.string === &quot;}&quot; || ctx.token.string === &quot;;&quot;) {
                        break;
                    }
                }
                if (!TokenUtils.moveNextToken(ctx)) {
                    break;
                }
            }
        }
        
        return _stripAtRules(selector);
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getInfoAtPos</h4>

    
    <div class="description"><p>Returns a context info object for the given cursor position</p>
</div>
    
<dl>
    <dt>editor</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">Editor</dd>
    <dd></dd>
    <dt>constPos</dt>
    <dd class="label label-info pull-left">{ch: number,line: number}</dd>
    <dd>A CM pos (likely from editor.getCursorPos())</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">{context: string,offset: number,name: string,index: number,values: Array.&lt;string&gt;,isNewItem: boolean,range: {start: {line: number,ch: number},end: {line: number,ch: number}}}</dd>
    <dd>A CSS context info object.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getInfoAtPos(editor, constPos) {
        &#x2F;&#x2F; We&#39;re going to be changing pos a lot, but we don&#39;t want to mess up
        &#x2F;&#x2F; the pos the caller passed in so we use extend to make a safe copy of it.	
        var pos = $.extend({}, constPos),
            ctx = TokenUtils.getInitialContext(editor._codeMirror, pos),
            offset = TokenUtils.offsetInToken(ctx),
            propName = &quot;&quot;,
            mode = editor.getModeForSelection();
        
        &#x2F;&#x2F; Check if this is inside a style block or in a css&#x2F;less document.
        if (mode !== &quot;css&quot; &amp;&amp; mode !== &quot;text&#x2F;x-scss&quot; &amp;&amp; mode !== &quot;text&#x2F;x-less&quot;) {
            return createInfo();
        }

        if (_isInPropName(ctx)) {
            return _getPropNameInfo(ctx, editor);
        }
        
        if (_isInPropValue(ctx)) {
            return _getRuleInfoStartingFromPropValue(ctx, editor);
        }

        if (_isInAtRule(ctx)) {
            return _getImportUrlInfo(ctx, editor);
        }
        
        return createInfo();
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>getRangeSelectors</h4>

    
    <div class="description"><p>Given a TextRange, extracts the selector(s) for the rule in the range and returns it.
Assumes the range only contains one rule; if there&#39;s more than one, it will return the
selector(s) for the first rule.</p>
</div>
    
<dl>
    <dt>range</dt>
    <dd class="label label-info pull-left">TextRange</dd>
    <dd>The range to extract the selector(s) from.</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>The selector(s) for the rule in the range.</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getRangeSelectors(range) {
        &#x2F;&#x2F; There&#39;s currently no immediate way to access a given line in a Document, because it&#39;s just
        &#x2F;&#x2F; stored as a string. Eventually, we should have Documents cache the lines in the document
        &#x2F;&#x2F; as well, or make them use CodeMirror documents which do the same thing.
        var i, startIndex = 0, endIndex, text = range.document.getText();
        for (i = 0; i &lt; range.startLine; i++) {
            startIndex = text.indexOf(&quot;\n&quot;, startIndex) + 1;
        }
        endIndex = startIndex;
        &#x2F;&#x2F; Go one line past the end line. We&#39;ll extract text up to but not including the last newline.
        for (i = range.startLine + 1; i &lt;= range.endLine + 1; i++) {
            endIndex = text.indexOf(&quot;\n&quot;, endIndex) + 1;
        }
        var allSelectors = extractAllSelectors(text.substring(startIndex, endIndex));
        
        &#x2F;&#x2F; There should only be one rule in the range, and if there are multiple selectors for
        &#x2F;&#x2F; the first rule, they&#39;ll all be recorded in the &quot;selectorGroup&quot; for the first selector,
        &#x2F;&#x2F; so we only need to look at the first one.
        return (allSelectors.length ? allSelectors[0].selectorGroup || allSelectors[0].selector : &quot;&quot;);
    }
        
    exports._findAllMatchingSelectorsInText = _findAllMatchingSelectorsInText; &#x2F;&#x2F; For testing only
    exports.findMatchingRules = findMatchingRules;
    exports.extractAllSelectors = extractAllSelectors;
    exports.extractAllNamedFlows = extractAllNamedFlows;
    exports.findSelectorAtDocumentPos = findSelectorAtDocumentPos;
    exports.reduceStyleSheetForRegExParsing = reduceStyleSheetForRegExParsing;
    exports.addRuleToDocument = addRuleToDocument;
    exports.consolidateRules = consolidateRules;
    exports.getRangeSelectors = getRangeSelectors;

    exports.SELECTOR = SELECTOR;
    exports.PROP_NAME = PROP_NAME;
    exports.PROP_VALUE = PROP_VALUE;
    exports.IMPORT_URL = IMPORT_URL;
    
    exports.getInfoAtPos = getInfoAtPos;

    &#x2F;&#x2F; The createInfo is really only for the unit tests so they can make the same  
    &#x2F;&#x2F; structure to compare results with.
    exports.createInfo = createInfo;
});</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>reduceStyleSheetForRegExParsing</h4>

    
    <div class="description"><p>Reduces the style sheet by removing comments and strings 
so that the content can be parsed using a regular expression</p>
</div>
    
<dl>
    <dt>content</dt>
    <span class="label label-non-nullable pull-left">non-nullable</span>
    <dd class="label label-info pull-left">string</dd>
    <dd>to reduce</dd>
</dl><dl>
    <dt>Returns: </dt>
    <dd class="label label-info pull-left">string</dd>
    <dd>reduced content</dd>
</dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function reduceStyleSheetForRegExParsing(content) {
        return _removeStrings(_removeComments(content));
    }</code></pre></div>
</section>

        </div>
      </div>
    </div>

    <script type="text/javascript" src="../../assets/js/prism.js"></script>
  </body>
</html>